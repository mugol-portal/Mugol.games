<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#030712">
    <title>Kelime Avƒ±: Crystal Responsive</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap');

        :root {
            --bg-grad-1: #1e1b4b;
            --bg-grad-2: #020617;
            --nebula-1: rgba(59, 130, 246, 0.15);
            --nebula-2: rgba(139, 92, 246, 0.15);
            --primary: #3b82f6;
            --accent: #8b5cf6;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --gold: #fbbf24;
            --bonus: #d946ef;
            --font-main: 'Outfit', sans-serif;
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-bg: rgba(15, 23, 42, 0.6);
            
            /* Dƒ∞NAMƒ∞K IZGARA DEƒûƒ∞≈ûKENƒ∞ (JS ile g√ºncellenir) */
            --grid-size: 8; 
        }

        * { box-sizing: border-box; user-select: none; -webkit-user-select: none; touch-action: none; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-grad-2);
            font-family: var(--font-main);
            margin: 0; padding: 0; width: 100vw; height: 100%; height: 100dvh;
            display: flex; flex-direction: column; overflow: hidden;
            color: var(--text-main);
        }

        /* --- ARKA PLAN --- */
        .universe-bg {
            position: fixed; top: -10%; left: -10%; width: 120%; height: 120%;
            background: radial-gradient(circle at 50% 120%, var(--bg-grad-1), var(--bg-grad-2) 60%);
            z-index: -3; overflow: hidden;
        }
        .vignette {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 50% 50%, transparent 50%, rgba(0,0,0,0.8) 120%);
            z-index: -1; pointer-events: none;
        }
        .nebula {
            position: absolute; width: 100%; height: 100%;
            background-image: 
                radial-gradient(circle at 20% 30%, var(--nebula-1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, var(--nebula-2) 0%, transparent 50%);
            filter: blur(60px); animation: nebulaPulse 12s infinite alternate;
        }
        @keyframes nebulaPulse { 0% { opacity: 0.5; transform: scale(1); } 100% { opacity: 0.8; transform: scale(1.1); } }
        .stars-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(white 1.5px, transparent 1.5px);
            background-size: 70px 70px; opacity: 0.25;
            mask-image: radial-gradient(circle at 50% 50%, black 30%, transparent 100%);
        }

        /* --- √úST PANEL --- */
        .glass-panel {
            margin: 5px 10px;
            background: var(--glass-bg);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border: 1px solid var(--glass-border);
            border-top: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.6);
            border-radius: 20px;
            padding: 8px 15px; z-index: 20;
            display: flex; flex-direction: column; gap: 5px;
            flex-shrink: 0; /* K√º√ß√ºlmesini engelle */
        }
        .ice-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, rgba(147, 197, 253, 0.3), transparent);
            pointer-events: none; opacity: 0; transition: opacity 0.5s; z-index: 5;
            mix-blend-mode: overlay;
        }
        .ice-overlay.active { opacity: 1; }

        .top-bar { display: flex; justify-content: space-between; align-items: center; }
        .category-badge h2 { margin: 0; font-size: 1.2rem; font-weight: 800; background: linear-gradient(to right, #fff, #cbd5e1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .category-badge span { font-size: 0.6rem; color: var(--primary); font-weight: 700; letter-spacing: 2px; text-transform: uppercase; display: block; }

        .hud-stats { display: flex; gap: 8px; }
        .stat-box { background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.05); padding: 4px 8px; border-radius: 8px; display: flex; flex-direction: column; align-items: flex-end; justify-content: center; }
        .stat-title { font-size: 0.45rem; color: #94a3b8; font-weight: 700; }
        .stat-num { font-size: 1rem; font-weight: 800; color: #fff; font-variant-numeric: tabular-nums; }
        .stat-num.gold { color: var(--gold); }

        .bars-container { display: flex; flex-direction: column; gap: 3px; margin-top: 2px; }
        .bar-wrapper { position: relative; width: 100%; height: 4px; background: rgba(0,0,0,0.3); border-radius: 3px; overflow: hidden; }
        .heat-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--primary), var(--accent), #f43f5e); background-size: 200% 100%; animation: gradientFlow 2s linear infinite; box-shadow: 0 0 10px var(--primary); transition: width 0.3s; }
        .time-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #10b981, #34d399); transition: width 1s linear; }
        .time-fill.frozen { background: #60a5fa; box-shadow: 0 0 15px #60a5fa; }
        @keyframes gradientFlow { 0% { background-position: 100% 0; } 100% { background-position: -100% 0; } }

        .controls-bar { display: flex; justify-content: space-between; align-items: center; margin-top: 4px; }
        .stars { display: flex; gap: 2px; }
        .star { font-size: 1rem; color: rgba(255,255,255,0.1); transition: 0.4s; }
        .star.active { color: var(--gold); text-shadow: 0 0 10px var(--gold); transform: scale(1.1); }
        .icon-btn { width: 36px; height: 36px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.05); background: rgba(255,255,255,0.03); color: #cbd5e1; font-size: 1rem; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .icon-btn:active { transform: scale(0.9); background: rgba(255,255,255,0.1); color: #fff; }
        .hint-btn { color: var(--gold); border-color: rgba(251, 191, 36, 0.15); background: rgba(251, 191, 36, 0.05); }
        .focus-btn { color: #60a5fa; border-color: rgba(96, 165, 250, 0.15); background: rgba(96, 165, 250, 0.05); }
        .freeze-btn { color: #93c5fd; border-color: rgba(147, 197, 253, 0.2); background: rgba(147, 197, 253, 0.08); }

        /* --- OYUN ALANI (TA≈ûMA SORUNU BURADA √á√ñZ√úLD√ú) --- */
        #game-area {
            flex: 1; /* Kalan t√ºm alanƒ± kapla */
            display: flex; justify-content: center; align-items: center;
            width: 100%; position: relative;
            overflow: hidden; /* Dƒ±≈üarƒ± ta≈üanlarƒ± gizle */
            perspective: 1200px;
        }

        .shake-screen { animation: shakeStrong 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shakeStrong { 0% { transform: translate(0, 0); } 20% { transform: translate(-4px, 4px); } 40% { transform: translate(-4px, -4px); } 60% { transform: translate(4px, 4px); } 80% { transform: translate(4px, -4px); } 100% { transform: translate(0, 0); } }

        #grid {
            display: grid;
            gap: 3px; 
            padding: 8px;
            background: rgba(15, 23, 42, 0.3);
            border-radius: 20px; 
            border: 1px solid rgba(255,255,255,0.08);
            box-shadow: 0 30px 80px -20px rgba(0,0,0,0.8), 0 0 30px var(--nebula-1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
            
            /* -- KRƒ∞Tƒ∞K D√úZELTME: Responsive Boyutlandƒ±rma -- */
            /* Ekranƒ±n geni≈üliƒüinin %96'sƒ± veya y√ºksekliƒüin %55'inden hangisi k√º√ß√ºkse onu al */
            width: min(96vw, 55vh); 
            height: min(96vw, 55vh); /* Kare olmasƒ±nƒ± zorla */
            margin: auto;
        }

        .cell {
            /* H√ºcreler grid i√ßine otomatik sƒ±ƒüar */
            width: 100%; height: 100%;
            background: linear-gradient(180deg, rgba(255,255,255,0.07) 0%, rgba(255,255,255,0.02) 100%);
            border-radius: 15%; /* Daha modern yuvarlaklƒ±k */
            display: flex; justify-content: center; align-items: center;
            
            /* Font boyutu Gridin genel boyutuna ve h√ºcre sayƒ±sƒ±na g√∂re hesaplanƒ±r */
            font-size: calc( (min(96vw, 55vh) - 20px) / var(--grid-size) * 0.65 );
            font-weight: 800;
            color: #e2e8f0; 
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
            cursor: pointer; position: relative;
            border-top: 1px solid rgba(255,255,255,0.15);
            border-bottom: 1px solid rgba(0,0,0,0.3);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            user-select: none;
        }

        .cell.selected { background: #fff; color: #020617; border-radius: 50%; transform: scale(0.92); box-shadow: 0 0 20px rgba(255,255,255,0.5); z-index: 10; border: none; text-shadow: none; }
        .cell.found { z-index: 5; color: #fff !important; font-weight: 900; border-radius: 8px; transform: scale(1); box-shadow: inset 0 0 10px rgba(255,255,255,0.3); text-shadow: 0 2px 4px rgba(0,0,0,0.4); animation: foundPop 0.5s; border: 1px solid rgba(255,255,255,0.4); }
        .cell.bonus-found { background: linear-gradient(135deg, #d946ef, #8b5cf6) !important; box-shadow: 0 0 15px var(--bonus); animation: bonusPulse 1s infinite alternate; }
        @keyframes bonusPulse { 0% { box-shadow: 0 0 10px var(--bonus); } 100% { box-shadow: 0 0 25px var(--bonus); } }
        @keyframes foundPop { 0% { transform: scale(0.5); } 100% { transform: scale(1); } }
        .cell.hint-flash { animation: hintPulse 0.5s ease-in-out 3; background: var(--gold) !important; color: #000 !important; }
        .cell.dimmed { opacity: 0.15; filter: blur(1px) grayscale(1); transform: scale(0.9); }

        /* --- ALT PANEL --- */
        #word-panel {
            flex: 0 0 auto; padding: 10px 15px;
            background: linear-gradient(to top, var(--bg-grad-2), transparent);
            max-height: 22vh; overflow-y: auto;
            mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
            padding-bottom: 60px; 
            transition: opacity 0.5s;
        }
        #word-panel.blind-mode { opacity: 0; pointer-events: none; }
        #word-list { display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; }
        .pill { padding: 5px 12px; border-radius: 10px; font-size: 0.75rem; font-weight: 700; color: #64748b; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.06); transition: 0.4s; }
        .pill.found { color: #fff; transform: scale(1); box-shadow: 0 4px 10px rgba(0,0,0,0.4); text-shadow: 0 1px 2px rgba(0,0,0,0.5); border: none; }

        /* --- POPUPS --- */
        #meaning-toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(150%); width: 90%; max-width: 400px; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-left: 4px solid var(--primary); border-radius: 16px; padding: 15px; box-shadow: 0 20px 50px rgba(0,0,0,0.8); z-index: 1000; transition: transform 0.5s cubic-bezier(0.2, 0.8, 0.2, 1); }
        #meaning-toast.active { transform: translateX(-50%) translateY(0); }
        .toast-header { display: flex; justify-content: space-between; align-items: baseline; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 5px; margin-bottom: 5px; }
        .toast-word { font-size: 1.2rem; font-weight: 800; color: #fff; }
        .toast-label { font-size: 0.6rem; color: var(--primary); font-weight: 700; }
        .toast-text { font-size: 0.9rem; color: #cbd5e1; line-height: 1.4; }

        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(2, 6, 23, 0.85); backdrop-filter: blur(10px); display: none; justify-content: center; align-items: center; z-index: 10000; padding: 20px; }
        .modal-glass { background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.95)); padding: 30px 20px; border-radius: 25px; border: 1px solid rgba(255,255,255,0.1); text-align: center; width: 100%; max-width: 350px; box-shadow: 0 30px 80px rgba(0,0,0,0.9); position: relative; overflow: hidden; }
        .btn-primary { width: 100%; padding: 15px; border-radius: 15px; border: none; font-size: 1rem; font-weight: 900; color: #fff; background: linear-gradient(135deg, var(--primary), var(--accent)); cursor: pointer; box-shadow: 0 8px 20px rgba(0,0,0, 0.4); transition: all 0.3s; margin-top: 15px; text-transform: uppercase; letter-spacing: 1px; position: relative; overflow: hidden; }
        .btn-primary::after { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); animation: btnShimmer 3s infinite; }
        @keyframes btnShimmer { 0%, 50% { left: -100%; } 100% { left: 100%; } }
        .btn-primary:active { transform: scale(0.97); }
        .btn-outline { background: transparent; border: 2px solid rgba(255,255,255,0.1); color: #94a3b8; margin-top: 10px; font-size: 0.9rem; }
        .toggle-switch { display: flex; align-items: center; justify-content: space-between; margin: 15px 0; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 12px; }

        #preview-bubble { position: fixed; background: rgba(255,255,255,0.95); backdrop-filter: blur(5px); color: #000; padding: 8px 16px; border-radius: 20px; font-weight: 800; font-size: 1.2rem; pointer-events: none; transform: translate(-50%, -80px); z-index: 9999; display: none; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        .particle { position: absolute; pointer-events: none; border-radius: 50%; animation: particleFade 0.8s ease-out forwards; z-index: 30; }
        @keyframes particleFade { 0% { transform: translate(0,0) scale(1); opacity: 1; } 100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; } }
        .heat-active .cell { animation: pulseGlow 2s infinite; }
        @keyframes pulseGlow { 0% { box-shadow: inset 0 0 0 rgba(255,255,255,0); } 50% { box-shadow: inset 0 0 15px rgba(255,255,255,0.5); } 100% { box-shadow: inset 0 0 0 rgba(255,255,255,0); } }
        .confetti { position: fixed; width: 6px; height: 6px; z-index: 2000; animation: fall linear forwards; pointer-events: none; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); opacity: 0; } }
        .float-score { position: fixed; font-weight: 900; font-size: 1.8rem; pointer-events: none; z-index: 2000; text-shadow: 0 4px 15px rgba(0,0,0,0.6); animation: floatUp 0.8s ease-out forwards; color: var(--gold); }
        .float-combo { font-size: 2.2rem; color: #f43f5e; animation: floatUpBoom 1s ease-out forwards; }
        .float-bonus { font-size: 1.6rem; color: var(--bonus); text-shadow: 0 0 15px var(--bonus); }
        @keyframes floatUp { 0% { transform: translateY(0) scale(0.8); opacity: 0; } 100% { transform: translateY(-60px) scale(1); opacity: 0; } }
        @keyframes floatUpBoom { 0% { transform: translateY(0) scale(0.5); opacity: 0; } 50% { transform: translateY(-40px) scale(1.2); opacity: 1; } 100% { transform: translateY(-100px) scale(1); opacity: 0; } }
        @keyframes shake {0%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}100%{transform:translateX(0)}}
    </style>
</head>
<body>

    <div class="universe-bg" id="parallax-bg">
        <div class="nebula" id="parallax-nebula"></div>
        <div class="stars-overlay" id="parallax-stars"></div>
    </div>
    <div class="vignette"></div>
    <div id="preview-bubble"></div>

    <div id="meaning-toast">
        <div class="toast-header">
            <span class="toast-word" id="toast-word-el">KELƒ∞ME</span>
            <span class="toast-label">S√ñZL√úK</span>
        </div>
        <div class="toast-text" id="toast-text-el">Anlam burada g√∂r√ºnecek.</div>
    </div>

    <div class="glass-panel">
        <div class="ice-overlay" id="ice-effect"></div>
        <div class="top-bar">
            <div class="category-badge">
                <span id="cat-title">KATEGORƒ∞</span>
                <h2 id="lvl-title">B√∂l√ºm 1</h2>
            </div>
            <div class="hud-stats">
                <div class="stat-box">
                    <span class="stat-title">KELƒ∞ME</span>
                    <span class="stat-num" id="word-count-display">0/0</span>
                </div>
                <div class="stat-box">
                    <span class="stat-title">SKOR</span>
                    <span class="stat-num gold" id="score">0</span>
                </div>
            </div>
        </div>

        <div class="bars-container">
            <div class="bar-wrapper"><div class="heat-fill" id="heat-bar"></div></div>
            <div class="bar-wrapper" style="height: 2px; background: rgba(255,255,255,0.1);"><div class="time-fill" id="time-bar"></div></div>
        </div>

        <div class="controls-bar">
            <div class="stars" id="stars-container">
                <span class="star active">‚òÖ</span><span class="star active">‚òÖ</span><span class="star active">‚òÖ</span>
            </div>
            <div style="display:flex; gap:6px;">
                <button class="icon-btn hint-btn" onclick="useHint()">üí°</button>
                <button class="icon-btn focus-btn" onclick="useFocus()">üëÅÔ∏è</button>
                <button class="icon-btn freeze-btn" onclick="useFreeze()">‚ùÑÔ∏è</button>
                <button class="icon-btn" id="sound-btn" onclick="toggleSound()">üîá</button>
                <button class="icon-btn" onclick="togglePause()">‚è∏Ô∏è</button>
            </div>
        </div>
    </div>

    <div id="game-area">
        <div id="grid"></div>
    </div>

    <div id="word-panel">
        <div id="word-list"></div>
    </div>

    <div class="modal" id="start-modal" style="display: flex;">
        <div class="modal-glass">
            <div class="breath" style="font-size:3rem; margin-bottom:10px; filter: drop-shadow(0 0 20px rgba(59,130,246,0.5));">üíé</div>
            <h1 class="breath" style="margin:0; font-size:2.5rem; font-weight:900; letter-spacing:-1px; line-height:1; color:#fff;">KELƒ∞ME<br>AVI</h1>
            <p style="color:#94a3b8; font-weight:700; letter-spacing:3px; font-size:0.7rem; margin-top:10px;">RESPONSIVE EDITION</p>
            <p id="saved-info" style="color:var(--gold); font-size:0.7rem; margin-top:5px; height:20px;"></p>
            <button class="btn-primary" onclick="startGame()">BA≈ûLA</button>
            <button class="btn-primary btn-outline" onclick="resetProgress()">ƒ∞lerlemeyi Sƒ±fƒ±rla</button>
        </div>
    </div>

    <div class="modal" id="pause-modal">
        <div class="modal-glass">
            <h1>ZAMAN DURDU</h1>
            <div class="toggle-switch" onclick="toggleBlindMode()">
                <span style="font-weight:700; font-size:0.8rem; text-align:left;">K√ñR MOD (X2 PUAN)<br><span style="font-size:0.6rem; color:#94a3b8; font-weight:400;">Listeyi gizler</span></span>
                <div id="blind-toggle-icon" style="font-size:1.2rem;">‚ö™</div>
            </div>
            <button class="btn-primary" onclick="togglePause()">DEVAM ET</button>
            <button class="btn-primary btn-outline" onclick="location.reload()">√áIKI≈û</button>
        </div>
    </div>

    <div class="modal" id="win-modal">
        <div class="modal-glass">
            <div id="win-badge" style="background:#fbbf24; color:#000; display:inline-block; padding:4px 12px; border-radius:20px; font-weight:bold; font-size:0.7rem; margin-bottom:10px; display:none;">KUSURSUZ!</div>
            <h1 style="font-size:2rem; margin:0;">HARƒ∞KA!</h1>
            <div id="win-stars-display" style="font-size:3rem; color:#fbbf24; margin:10px 0; text-shadow: 0 0 30px rgba(251,191,36,0.5);">‚òÖ‚òÖ‚òÖ</div>
            <p id="level-stats" style="color:#94a3b8; font-size:0.9rem;">Skor: 0</p>
            <button class="btn-primary" onclick="nextLevel()">SONRAKƒ∞ SEVƒ∞YE</button>
        </div>
    </div>

    <script>
    const WORD_POOLS = {
        "Renkler": [{w:"MAVƒ∞",m:"G√∂ky√ºz√º rengi"},{w:"YE≈ûƒ∞L",m:"Doƒüa rengi"},{w:"SARI",m:"G√ºne≈ü rengi"},{w:"KIRMIZI",m:"Ate≈ü rengi"},{w:"MOR",m:"Asalet rengi"},{w:"Sƒ∞YAH",m:"Karanlƒ±k"},{w:"BEYAZ",m:"Aydƒ±nlƒ±k"},{w:"TURUNCU",m:"Portakal rengi"},{w:"PEMBE",m:"≈ûeker rengi"},{w:"GRƒ∞",m:"Bulutlu hava"},{w:"LACƒ∞VERT",m:"Gece mavisi"},{w:"BORDO",m:"Koyu kƒ±rmƒ±zƒ±"},{w:"TURKUAZ",m:"Deniz rengi"},{w:"BEJ",m:"A√ßƒ±k toprak"},{w:"Lƒ∞LA",m:"A√ßƒ±k mor"},{w:"ALTIN",m:"Deƒüerli sarƒ±"},{w:"G√úM√ú≈û",m:"Parlak gri"},{w:"KAHVE",m:"Toprak rengi"}],
        "Meyveler": [{w:"ELMA",m:"Kƒ±rmƒ±zƒ±/Ye≈üil"},{w:"ARMUT",m:"Sulu meyve"},{w:"MUZ",m:"Sarƒ± uzun"},{w:"Kƒ∞RAZ",m:"√áift saplƒ±"},{w:"√áƒ∞LEK",m:"Kƒ±rmƒ±zƒ± benekli"},{w:"KARPUZ",m:"Yazƒ±n kralƒ±"},{w:"KAVUN",m:"Sarƒ± yaz meyvesi"},{w:"√úZ√úM",m:"Salkƒ±mlƒ±"},{w:"ANANAS",m:"Tropikal"},{w:"AYVA",m:"Sarƒ± kƒ±≈ü meyvesi"},{w:"NAR",m:"Bereket simgesi"},{w:"Kƒ∞Vƒ∞",m:"Ye≈üil i√ßli"},{w:"DUT",m:"Aƒüa√ß yemi≈üi"},{w:"ƒ∞NCƒ∞R",m:"Tatlƒ±"},{w:"MANDALƒ∞NA",m:"Turuncu"},{w:"PORTAKAL",m:"C vitamini"},{w:"ERƒ∞K",m:"Ye≈üil ek≈üi"},{w:"KAYISI",m:"Yumu≈üak"},{w:"≈ûEFTALƒ∞",m:"T√ºyl√º"}],
        "V√ºcut": [{w:"BA≈û",m:"V√ºcudun tepesi"},{w:"G√ñZ",m:"G√∂rme organƒ±"},{w:"KULAK",m:"ƒ∞≈üitme organƒ±"},{w:"BURUN",m:"Koku organƒ±"},{w:"AƒûIZ",m:"Tat alma"},{w:"EL",m:"Tutma organƒ±"},{w:"AYAK",m:"Y√ºr√ºme organƒ±"},{w:"KALP",m:"Kan pompalar"},{w:"Mƒ∞DE",m:"Sindirir"},{w:"BEYƒ∞N",m:"Y√∂netir"},{w:"Dƒ∞≈û",m:"√áiƒüneme aracƒ±"},{w:"Dƒ∞L",m:"Tat alma"},{w:"TIRNAK",m:"Parmak ucu"},{w:"SA√á",m:"Ba≈ü √∂rt√ºs√º"},{w:"KOL",m:"Uzuv"},{w:"BACAK",m:"Uzuv"}],
        "Hayvanlar": [{w:"ASLAN",m:"Orman kralƒ±"},{w:"KAPLAN",m:"√áizgili kedi"},{w:"Fƒ∞L",m:"Hortumlu dev"},{w:"Z√úRAFA",m:"Uzun boyunlu"},{w:"MAYMUN",m:"Muz sever"},{w:"YILAN",m:"S√ºr√ºn√ºr"},{w:"KARTAL",m:"Yƒ±rtƒ±cƒ± ku≈ü"},{w:"YUNUS",m:"Zeki denizci"},{w:"PENGUEN",m:"U√ßamaz"},{w:"KEDƒ∞",m:"Evcil dost"},{w:"K√ñPEK",m:"Sadƒ±k dost"},{w:"KU≈û",m:"Kanatlƒ±"},{w:"BALIK",m:"Suda ya≈üar"},{w:"AT",m:"Binek hayvanƒ±"},{w:"AYI",m:"Bal sever"},{w:"KURT",m:"Vah≈üi k√∂pek"},{w:"Tƒ∞LKƒ∞",m:"Kurnaz"}],
        "Astronomi": [{w:"GEZEGEN",m:"Y√∂r√ºngede d√∂ner"},{w:"YILDIZ",m:"I≈üƒ±k kaynaƒüƒ±"},{w:"G√úNE≈û",m:"Isƒ± kaynaƒüƒ±"},{w:"D√úNYA",m:"Ya≈üam alanƒ±"},{w:"MARS",m:"Kƒ±zƒ±l gezegen"},{w:"AY",m:"Uydumuz"},{w:"KUYRUKLU",m:"Yƒ±ldƒ±z t√ºr√º"},{w:"GALAKSƒ∞",m:"Yƒ±ldƒ±z k√ºmesi"},{w:"UZAY",m:"Sonsuz bo≈üluk"},{w:"METEOR",m:"G√∂k ta≈üƒ±"},{w:"ASTRONOT",m:"Uzay adamƒ±"},{w:"ROKET",m:"Uzay aracƒ±"},{w:"SAT√úRN",m:"Halkalƒ±"},{w:"J√úPƒ∞TER",m:"Dev gezegen"},{w:"VEN√úS",m:"√áoban yƒ±ldƒ±zƒ±"}],
        "Mutfak": [{w:"TENCERE",m:"Yemek pi≈üirilir"},{w:"TAVA",m:"Kƒ±zartma aracƒ±"},{w:"√áATAL",m:"Yemek yerken"},{w:"KA≈ûIK",m:"Sƒ±vƒ± i√ßin"},{w:"BI√áAK",m:"Kesmek i√ßin"},{w:"TABAK",m:"Servis aracƒ±"},{w:"BARDAK",m:"ƒ∞√ßmek i√ßin"},{w:"FIRIN",m:"Isƒ±tƒ±r"},{w:"BUZDOLABI",m:"Soƒüutur"},{w:"KEP√áE",m:"√áorba i√ßin"},{w:"S√úZGE√á",m:"S√ºzmek i√ßin"},{w:"RENDE",m:"Par√ßalar"},{w:"TEPSƒ∞",m:"Ta≈üƒ±ma aracƒ±"},{w:"KASE",m:"Derin kap"}],
        "Okul": [{w:"SINIF",m:"Derslik"},{w:"√ñƒûRETMEN",m:"Eƒüitmen"},{w:"√ñƒûRENCƒ∞",m:"Talebe"},{w:"Kƒ∞TAP",m:"Okuma aracƒ±"},{w:"DEFTER",m:"Yazma aracƒ±"},{w:"KALEM",m:"Yazar"},{w:"Sƒ∞LGƒ∞",m:"Siler"},{w:"CETVEL",m:"√ñl√ßer"},{w:"TEBE≈ûƒ∞R",m:"Tahta kalemi"},{w:"TAHTA",m:"Yazƒ± alanƒ±"},{w:"√áANTA",m:"E≈üya ta≈üƒ±r"},{w:"SIRASI",m:"Oturak"},{w:"DERS",m:"Konu"},{w:"TENEFF√úS",m:"Mola"},{w:"√ñDEV",m:"Ev √ßalƒ±≈ümasƒ±"}]
    };

    const LEVEL_CONFIGS = [
        { cat: "Renkler", count: 6, minGrid: 7, time: 60 },
        { cat: "Meyveler", count: 7, minGrid: 8, time: 80 },
        { cat: "V√ºcut", count: 8, minGrid: 8, time: 90 },
        { cat: "Hayvanlar", count: 8, minGrid: 9, time: 100 },
        { cat: "Okul", count: 8, minGrid: 9, time: 100 },
        { cat: "Mutfak", count: 9, minGrid: 10, time: 110 },
        { cat: "Astronomi", count: 9, minGrid: 11, time: 120 }
    ];

    const THEMES = [
        { name: "Cosmos",   bg1: "#1e1b4b", bg2: "#020617", primary: "#3b82f6", accent: "#8b5cf6" }, 
        { name: "Nebula",   bg1: "#4a044e", bg2: "#2e1065", primary: "#d946ef", accent: "#a855f7" }, 
        { name: "Aurora",   bg1: "#064e3b", bg2: "#022c22", primary: "#10b981", accent: "#34d399" }, 
        { name: "Mars",     bg1: "#7f1d1d", bg2: "#450a0a", primary: "#ef4444", accent: "#f97316" }, 
        { name: "Abyss",    bg1: "#172554", bg2: "#0f172a", primary: "#0ea5e9", accent: "#38bdf8" }, 
        { name: "Sun",      bg1: "#9a3412", bg2: "#431407", primary: "#f59e0b", accent: "#fbbf24" }  
    ];

    const GRADIENTS = ['linear-gradient(135deg, #ef4444, #b91c1c)', 'linear-gradient(135deg, #3b82f6, #1d4ed8)', 'linear-gradient(135deg, #10b981, #047857)', 'linear-gradient(135deg, #f59e0b, #b45309)', 'linear-gradient(135deg, #d946ef, #a21caf)', 'linear-gradient(135deg, #06b6d4, #0e7490)'];

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let musicOscillators = [];
    let currentLevelIdx = 0, gridSize = 8, grid = [], currentWordsObj = [], bonusWords = [];
    let foundCount = 0, currentScore = 0, displayedScore = 0;
    let timerInterval, isSelecting = false, startCell = null, selectedCells = [];
    let lockedAxis = null, mistakeCount = 0, cardTimeout;
    let heatValue = 0, isHeatActive = false, heatDecay = 0.5;
    let soundEnabled = false, isPaused = false;
    let wordLocations = {};
    let startTime = 0, levelTimeGoal = 100;
    let totalScore = 0, lastFoundTime = 0, comboMultiplier = 1, isBlindMode = false, isTimeFrozen = false, freezeTimeout;

    window.onload = () => { 
        loadProgress(); applyTheme(currentLevelIdx);
        document.addEventListener('mousemove', (e) => {
            const x = (window.innerWidth - e.pageX * 2) / 100, y = (window.innerHeight - e.pageY * 2) / 100;
            document.getElementById('parallax-nebula').style.transform = `translate(${x}px, ${y}px) scale(1.1)`;
            document.getElementById('parallax-stars').style.transform = `translate(${x*2}px, ${y*2}px)`;
        });
    };

    function loadProgress() {
        const saved = localStorage.getItem('crystalWordSaveUlt');
        if(saved) {
            const data = JSON.parse(saved); currentLevelIdx = data.level || 0; totalScore = data.totalScore || 0;
            document.getElementById('saved-info').textContent = `Kayƒ±t: Seviye ${currentLevelIdx + 1} - Puan: ${totalScore}`;
        }
    }
    function saveProgress() { localStorage.setItem('crystalWordSaveUlt', JSON.stringify({ level: currentLevelIdx, totalScore: totalScore })); }
    function resetProgress() { localStorage.removeItem('crystalWordSaveUlt'); currentLevelIdx = 0; totalScore = 0; document.getElementById('saved-info').textContent = "Kayƒ±t Silindi"; }
    function applyTheme(levelIndex) {
        const theme = THEMES[levelIndex % THEMES.length];
        const r = document.documentElement.style;
        r.setProperty('--bg-grad-1', theme.bg1); r.setProperty('--bg-grad-2', theme.bg2);
        r.setProperty('--primary', theme.primary); r.setProperty('--accent', theme.accent);
        r.setProperty('--nebula-1', theme.primary + '26'); r.setProperty('--nebula-2', theme.accent + '26');
    }

    function startGame() { document.getElementById('start-modal').style.display = 'none'; if(audioCtx.state === 'suspended') audioCtx.resume(); loadLevel(); }
    function getRandomWords(category) { const pool = [...WORD_POOLS[category]]; for (let i = pool.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [pool[i], pool[j]] = [pool[j], pool[i]]; } return pool; }

    function loadLevel() {
        document.getElementById('win-modal').style.display = 'none';
        const config = LEVEL_CONFIGS[currentLevelIdx % LEVEL_CONFIGS.length];
        applyTheme(currentLevelIdx);
        
        const allPool = getRandomWords(config.cat);
        currentWordsObj = allPool.slice(0, config.count);
        bonusWords = allPool.slice(config.count, config.count + 2);

        const longestMain = Math.max(...currentWordsObj.map(o => o.w.length));
        const longestBonus = Math.max(...bonusWords.map(o => o.w.length));
        gridSize = Math.max(config.minGrid, longestMain + 1, longestBonus + 1);
        
        // CSS Variable Update for responsive logic
        document.documentElement.style.setProperty('--grid-size', gridSize);

        levelTimeGoal = config.time;
        foundCount = 0; currentScore = 0; displayedScore = 0; mistakeCount = 0;
        heatValue = 0; isHeatActive = false; comboMultiplier = 1; lastFoundTime = 0; wordLocations = {};
        startTime = Date.now(); isTimeFrozen = false;
        document.getElementById('ice-effect').classList.remove('active'); document.getElementById('time-bar').classList.remove('frozen');
        document.getElementById('lvl-title').textContent = `B√ñL√úM ${currentLevelIdx + 1}`;
        document.getElementById('cat-title').textContent = config.cat;
        document.getElementById('score').textContent = totalScore;
        document.getElementById('word-count-display').textContent = `0/${currentWordsObj.length}`;
        document.getElementById('game-area').classList.remove('heat-active');
        const wordPanel = document.getElementById('word-panel');
        if(isBlindMode) wordPanel.classList.add('blind-mode'); else wordPanel.classList.remove('blind-mode');
        createGrid(); renderWordList();
        if(timerInterval) clearInterval(timerInterval); timerInterval = setInterval(gameLoop, 100);
    }

    function toggleBlindMode() { isBlindMode = !isBlindMode; document.getElementById('blind-toggle-icon').textContent = isBlindMode ? 'üü¢' : '‚ö™'; const wordPanel = document.getElementById('word-panel'); if(isBlindMode) wordPanel.classList.add('blind-mode'); else wordPanel.classList.remove('blind-mode'); }

    function gameLoop() {
        if(isPaused) return;
        if(heatValue > 0) heatValue -= heatDecay; if(heatValue < 0) heatValue = 0;
        updateHeatUI(); updateStars();
        let target = totalScore + currentScore; let d = document.getElementById('score'); let c = parseInt(d.textContent);
        if(c < target) d.textContent = c + Math.ceil((target - c) / 5);
    }
    function updateHeatUI() {
        const bar = document.getElementById('heat-bar'); bar.style.width = `${heatValue}%`;
        if(heatValue >= 100 && !isHeatActive) { isHeatActive = true; playSound('powerup'); document.getElementById('game-area').classList.add('heat-active'); }
        else if (heatValue < 50 && isHeatActive) { isHeatActive = false; document.getElementById('game-area').classList.remove('heat-active'); }
    }
    function updateStars() {
        if(isTimeFrozen) return;
        const elapsed = (Date.now() - startTime) / 1000; const stars = document.querySelectorAll('#stars-container .star'); const timeBar = document.getElementById('time-bar');
        const percentLeft = Math.max(0, 100 - (elapsed / (levelTimeGoal * 1.5) * 100));
        timeBar.style.width = `${percentLeft}%`;
        if(percentLeft < 20) timeBar.style.background = '#f43f5e'; else timeBar.style.background = 'linear-gradient(90deg, #10b981, #34d399)';
        if(elapsed > levelTimeGoal * 1.5) { stars[2].classList.remove('active'); stars[1].classList.remove('active'); }
        else if(elapsed > levelTimeGoal) { stars[2].classList.remove('active'); } else { stars.forEach(s => s.classList.add('active')); }
    }

    function createGrid() {
        const gridEl = document.getElementById('grid'); gridEl.innerHTML = '';
        gridEl.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
        grid = Array(gridSize).fill(null).map(() => Array(gridSize).fill(''));
        const allToPlace = [...currentWordsObj.map(o=>o.w), ...bonusWords.map(o=>o.w)];
        allToPlace.sort((a,b)=>b.length-a.length).forEach(placeWord);
        const chars = "ABC√áDEFGƒûHIƒ∞JKLMNO√ñPRS≈ûTU√úVYZ";
        let delay = 0;
        for(let r=0; r<gridSize; r++) {
            for(let c=0; c<gridSize; c++) {
                if(grid[r][c] === '') grid[r][c] = chars[Math.floor(Math.random() * chars.length)];
                const cell = document.createElement('div'); cell.className = 'cell'; cell.textContent = grid[r][c]; cell.dataset.r = r; cell.dataset.c = c; cell.style.animationDelay = `${delay}s`; delay += 0.002;
                const handler = (e) => { if(e.type === 'touchstart') e.preventDefault(); startSel(e); };
                cell.onmousedown = handler; cell.ontouchstart = handler; gridEl.appendChild(cell);
            }
        }
        document.onmousemove = moveSel; document.ontouchmove = moveSel; document.onmouseup = endSel; document.ontouchend = endSel;
    }
    function placeWord(word) {
        let placed = false, attempts = 0;
        while(!placed && attempts < 300) {
            const dir = Math.floor(Math.random() * 3), r = Math.floor(Math.random() * gridSize), c = Math.floor(Math.random() * gridSize);
            if(canPlace(word, r, c, dir)) {
                for(let i=0; i<word.length; i++) { if(dir === 0) grid[r][c+i] = word[i]; else if(dir === 1) grid[r+i][c] = word[i]; else grid[r+i][c+i] = word[i]; }
                wordLocations[word] = {r, c, dir, len: word.length}; placed = true;
            } attempts++;
        }
    }
    function canPlace(word, r, c, dir) {
        if(dir === 0 && c + word.length > gridSize) return false; if(dir === 1 && r + word.length > gridSize) return false; if(dir === 2 && (c + word.length > gridSize || r + word.length > gridSize)) return false;
        for(let i=0; i<word.length; i++) { let tr = r, tc = c; if(dir === 0) tc += i; else if(dir === 1) tr += i; else { tr += i; tc += i; } let val = grid[tr][tc]; if(val !== '' && val !== word[i]) return false; } return true;
    }
    function renderWordList() {
        const el = document.getElementById('word-list'); el.innerHTML = '';
        currentWordsObj.forEach(obj => { const tag = document.createElement('div'); tag.className = 'pill'; tag.textContent = obj.w; tag.id = `tag-${obj.w}`; el.appendChild(tag); });
    }

    function useHint() {
        if(isPaused) return;
        const hiddenWords = currentWordsObj.filter(obj => !document.getElementById(`tag-${obj.w}`).classList.contains('found'));
        if(hiddenWords.length > 0) {
            const target = hiddenWords[Math.floor(Math.random() * hiddenWords.length)].w; const loc = wordLocations[target];
            const cell = document.querySelector(`.cell[data-r="${loc.r}"][data-c="${loc.c}"]`);
            if(cell) { cell.classList.remove('hint-flash'); void cell.offsetWidth; cell.classList.add('hint-flash'); playSound('hint'); currentScore = Math.max(0, currentScore - 50); showFloatingText(cell.getBoundingClientRect().left, cell.getBoundingClientRect().top, "-50 Puan", true); }
        }
    }
    function useFocus() {
        if(isPaused) return; const hiddenWords = currentWordsObj.filter(obj => !document.getElementById(`tag-${obj.w}`).classList.contains('found')); if(hiddenWords.length === 0) return;
        currentScore = Math.max(0, currentScore - 75); showFloatingText(window.innerWidth/2, window.innerHeight/2, "ODAK -75", true); playSound('powerup');
        const target = hiddenWords[0].w; const loc = wordLocations[target];
        const allCells = document.querySelectorAll('.cell');
        allCells.forEach(c => {
            const r = parseInt(c.dataset.r), col = parseInt(c.dataset.c); let isTarget = false;
            for(let i=0; i<loc.len; i++) { let tr = loc.r, tc = loc.c; if(loc.dir === 0) tc += i; else if(loc.dir === 1) tr += i; else { tr += i; tc += i; } if(r === tr && col === tc) isTarget = true; }
            if(!isTarget && !c.classList.contains('found') && !c.classList.contains('bonus-found')) c.classList.add('dimmed');
        }); setTimeout(() => document.querySelectorAll('.dimmed').forEach(c => c.classList.remove('dimmed')), 3000);
    }
    function useFreeze() {
        if(isPaused || isTimeFrozen) return; isTimeFrozen = true; currentScore = Math.max(0, currentScore - 30); showFloatingText(window.innerWidth/2, window.innerHeight/2, "ZAMAN DONDU!", true);
        document.getElementById('ice-effect').classList.add('active'); document.getElementById('time-bar').classList.add('frozen'); playSound('powerup');
        const freezeStart = Date.now(); clearTimeout(freezeTimeout);
        freezeTimeout = setTimeout(() => { isTimeFrozen = false; startTime += (Date.now() - freezeStart); document.getElementById('ice-effect').classList.remove('active'); document.getElementById('time-bar').classList.remove('frozen'); }, 10000);
    }

    function playSound(type) {
        if(!soundEnabled) return; const now = audioCtx.currentTime; const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.connect(gain); gain.connect(audioCtx.destination);
        if(type === 'success') { osc.type = 'sine'; osc.frequency.setValueAtTime(400, now); osc.frequency.linearRampToValueAtTime(800, now + 0.1); gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.4); osc.start(now); osc.stop(now + 0.4); }
        else if(type === 'bonus') { osc.type = 'triangle'; osc.frequency.setValueAtTime(600, now); osc.frequency.linearRampToValueAtTime(1200, now + 0.3); gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.6); osc.start(now); osc.stop(now + 0.6); }
        else if(type === 'powerup') { osc.type = 'triangle'; osc.frequency.setValueAtTime(200, now); osc.frequency.linearRampToValueAtTime(600, now + 0.5); gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now + 0.5); osc.start(now); osc.stop(now + 0.5); }
        else if(type === 'hint') { osc.type = 'square'; osc.frequency.setValueAtTime(800, now); gain.gain.setValueAtTime(0.05, now); gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3); osc.start(now); osc.stop(now + 0.3); }
    }
    function toggleSound() { soundEnabled = !soundEnabled; document.getElementById('sound-btn').textContent = soundEnabled ? 'üîä' : 'üîá'; if(soundEnabled) { if(musicOscillators.length === 0) [110, 164.81, 196, 220].forEach(f => { const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type = 'sine'; o.frequency.value = f; g.gain.value = 0.02; o.connect(g); g.connect(audioCtx.destination); o.start(); musicOscillators.push({osc:o, gain:g}); }); else musicOscillators.forEach(o => o.gain.gain.setTargetAtTime(0.02, audioCtx.currentTime, 1)); } else musicOscillators.forEach(o => o.gain.gain.setTargetAtTime(0, audioCtx.currentTime, 0.5)); }
    function togglePause() { isPaused = !isPaused; document.getElementById('pause-modal').style.display = isPaused ? 'flex' : 'none'; document.getElementById('game-area').style.filter = isPaused ? 'blur(20px)' : 'none'; }
    function triggerScreenShake() { const ga = document.getElementById('game-area'); ga.classList.remove('shake-screen'); void ga.offsetWidth; ga.classList.add('shake-screen'); }

    function checkWord(w) {
        const wordExists = currentWordsObj.some(obj => obj.w === w);
        if(wordExists) {
            const tag = document.getElementById(`tag-${w}`); if(tag.classList.contains('found')) return false;
            foundCount++; document.getElementById('word-count-display').textContent = `${foundCount}/${currentWordsObj.length}`;
            const now = Date.now(); if (now - lastFoundTime < 5000) comboMultiplier++; else comboMultiplier = 1; lastFoundTime = now;
            if(comboMultiplier > 2) triggerScreenShake();
            heatValue += 35; if(heatValue > 100) heatValue = 100;
            const pts = (w.length * 100) * (isHeatActive ? 2 : 1) * comboMultiplier * (isBlindMode ? 2 : 1); currentScore += pts; 
            const rect = selectedCells[selectedCells.length - 1].getBoundingClientRect();
            if(comboMultiplier > 1) showFloatingText(window.innerWidth/2, window.innerHeight/2, `KOMBO x${comboMultiplier}!`, true, true); else showFloatingText(rect.left, rect.top, `+${pts}`, isHeatActive);
            const grad = GRADIENTS[(foundCount - 1) % GRADIENTS.length]; tag.classList.add('found'); tag.style.background = grad;
            const centerRect = selectedCells[Math.floor(selectedCells.length/2)].getBoundingClientRect(); spawnParticles(centerRect.left+15, centerRect.top+15, '#fbbf24');
            selectedCells.forEach(cell => { cell.classList.remove('selected'); cell.classList.add('found'); cell.style.background = grad; });
            playSound('success'); showMeaning(w); 
            if(foundCount === currentWordsObj.length) { clearInterval(timerInterval); setTimeout(showWin, 1500); } return true;
        } 
        const bonusObj = bonusWords.find(obj => obj.w === w);
        if(bonusObj) {
            if(selectedCells[0].classList.contains('bonus-found')) return false;
            currentScore += 200; startTime += 5000; triggerScreenShake(); playSound('bonus'); showFloatingText(window.innerWidth/2, window.innerHeight/2, "Gƒ∞ZLƒ∞ KELƒ∞ME! +200", true, false, true);
            selectedCells.forEach(cell => { cell.classList.remove('selected'); cell.classList.add('bonus-found'); }); return true;
        }
        return false;
    }

    function spawnParticles(x, y, color) { for(let i=0; i<15; i++) { const p = document.createElement('div'); p.className = 'particle'; p.style.backgroundColor = color; p.style.left = x + 'px'; p.style.top = y + 'px'; p.style.width = (Math.random()*8+4)+'px'; p.style.height = p.style.width; const angle = Math.random()*Math.PI*2, velocity = Math.random()*100+40; p.style.setProperty('--tx', Math.cos(angle)*velocity+'px'); p.style.setProperty('--ty', Math.sin(angle)*velocity+'px'); document.body.appendChild(p); setTimeout(()=>p.remove(), 800); } }
    function showFloatingText(x, y, text, isBonus, isCombo, isBonusWord) { const el = document.createElement('div'); if(isCombo) el.className = 'float-score float-combo'; else if(isBonusWord) el.className = 'float-score float-bonus'; else el.className = 'float-score'; el.textContent = text; el.style.left = x+'px'; el.style.top = y+'px'; if(isBonus && !isCombo && !isBonusWord) { el.style.fontSize = '1.5rem'; el.style.color = '#f43f5e'; } document.body.appendChild(el); setTimeout(() => el.remove(), (isCombo||isBonusWord) ? 1200 : 800); }
    function showMeaning(wordText) { const wordObj = currentWordsObj.find(o => o.w === wordText); if(wordObj) { const toast = document.getElementById('meaning-toast'); document.getElementById('toast-word-el').textContent = wordObj.w; document.getElementById('toast-text-el').textContent = wordObj.m; toast.style.borderColor = `var(--primary)`; toast.classList.add('active'); clearTimeout(cardTimeout); cardTimeout = setTimeout(() => { toast.classList.remove('active'); }, 4000); } }

    const previewBubble = document.getElementById('preview-bubble');
    function startSel(e) { if(isPaused) return; isSelecting = true; lockedAxis = null; const t = e.target.closest('.cell'); if(t) { startCell = {r: parseInt(t.dataset.r), c: parseInt(t.dataset.c)}; drawSel(t); } }
    function moveSel(e) { if(!isSelecting || isPaused) return; let cx = e.type.includes('touch') ? e.touches[0].clientX : e.clientX, cy = e.type.includes('touch') ? e.touches[0].clientY : e.clientY; let t = document.elementFromPoint(cx, cy); if(t && t.classList.contains('cell')) { const rc = parseInt(t.dataset.r), cc = parseInt(t.dataset.c), rs = startCell.r, cs = startCell.c; if(!lockedAxis && (rc !== rs || cc !== cs)) { const dr = Math.abs(rc - rs), dc = Math.abs(cc - cs); if(dr === 0) lockedAxis = 'row'; else if(dc === 0) lockedAxis = 'col'; else if(Math.abs(dr - dc) < 2) lockedAxis = 'diag'; } let target = t; if(lockedAxis === 'row') target = document.querySelector(`.cell[data-r="${rs}"][data-c="${cc}"]`); else if(lockedAxis === 'col') target = document.querySelector(`.cell[data-r="${rc}"][data-c="${cs}"]`); else if(lockedAxis === 'diag') { const dist = Math.abs(rc - rs), rDir = rc > rs ? 1 : -1, cDir = cc > cs ? 1 : -1; target = document.querySelector(`.cell[data-r="${rs + dist*rDir}"][data-c="${cs + dist*cDir}"]`); } if(target) { drawSel(target); const txt = selectedCells.map(c => c.textContent).join(''); if(txt.length>0) { previewBubble.style.display='block'; previewBubble.textContent=txt; previewBubble.style.left=cx+'px'; previewBubble.style.top=cy+'px'; } } } }
    function drawSel(t) { document.querySelectorAll('.cell.selected').forEach(c => c.classList.remove('selected')); selectedCells = []; const r1 = startCell.r, c1 = startCell.c, r2 = parseInt(t.dataset.r), c2 = parseInt(t.dataset.c), dr = r2 - r1, dc = c2 - c1, steps = Math.max(Math.abs(dr), Math.abs(dc)), sr = dr === 0 ? 0 : dr/steps, sc = dc === 0 ? 0 : dc/steps; for(let i=0; i<=steps; i++) { const nextR = Math.round(r1 + i*sr), nextC = Math.round(c1 + i*sc), cell = document.querySelector(`.cell[data-r="${nextR}"][data-c="${nextC}"]`); if(cell) { cell.classList.add('selected'); selectedCells.push(cell); } } }
    function endSel() { if(!isSelecting) return; isSelecting = false; lockedAxis = null; previewBubble.style.display = 'none'; const txt = selectedCells.map(c => c.textContent).join(''), rev = txt.split('').reverse().join(''); let matched = checkWord(txt); if(!matched) matched = checkWord(rev); if(!matched) { mistakeCount++; const gridEl = document.getElementById('grid'); gridEl.style.animation = 'none'; gridEl.offsetHeight; gridEl.style.animation = 'shake 0.4s'; if(navigator.vibrate) navigator.vibrate(50); selectedCells.forEach(c => c.classList.remove('selected')); } }

    function launchConfetti() { const theme = THEMES[currentLevelIdx % THEMES.length], colors = [theme.primary, theme.accent, '#fbbf24', '#ffffff']; for(let i=0; i<80; i++) { const c = document.createElement('div'); c.className = 'confetti'; c.style.left = Math.random()*100 + 'vw'; c.style.top = -10 + 'px'; c.style.background = colors[Math.floor(Math.random()*colors.length)]; c.style.animationDuration = (2 + Math.random()*3) + 's'; document.body.appendChild(c); setTimeout(()=>c.remove(), 5000); } }
    function showWin() { launchConfetti(); totalScore += currentScore; saveProgress(); document.getElementById('level-stats').textContent = `B√∂l√ºm Skoru: ${currentScore} | Toplam: ${totalScore}`; document.getElementById('win-badge').style.display = mistakeCount === 0 ? 'inline-block' : 'none'; document.getElementById('win-modal').style.display = 'flex'; }
    function nextLevel() { currentLevelIdx++; loadLevel(); }
    </script>
</body>
</html>