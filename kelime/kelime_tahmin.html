<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kelime Ustasƒ±: Saf T√ºrk√ße v6.1</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --neon-blue: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-purple: #bc13fe;
            --neon-green: #0aff68;
            --neon-yellow: #ffee00;
            --neon-red: #ff2a2a;
            --bg-deep: #080815;
            
            --correct: #0aff68;
            --present: #ffee00;
            --absent-bg: #2d2d42; 
            --absent-text: #8b8b9e;
            
            --tile-glass: rgba(25, 25, 45, 0.7);
            --tile-border: rgba(255, 255, 255, 0.15);
            --tile-active-glow: rgba(0, 243, 255, 0.4);
            
            --tile-size: 55px;
        }

        /* TEMA RENKLERƒ∞ */
        body[data-theme="orman"]   { --neon-blue: #4ade80; --neon-pink: #166534; --neon-purple: #a3e635; }
        body[data-theme="okyanus"] { --neon-blue: #38bdf8; --neon-pink: #0284c7; --neon-purple: #0ea5e9; }
        body[data-theme="volkan"]  { --neon-blue: #fbbf24; --neon-pink: #f43f5e; --neon-purple: #9f1239; }

        * { box-sizing: border-box; touch-action: manipulation; user-select: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            background-color: var(--bg-deep);
            color: #fff;
            font-family: 'Outfit', sans-serif;
            height: 100dvh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* --- ARKA PLAN --- */
        .universe { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; overflow: hidden; }
        
        .grid-overlay {
            position: absolute; width: 200%; height: 200%; top: -50%; left: -50%;
            background-image: 
                linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            transform: perspective(300px) rotateX(40deg);
            animation: gridMove 20s linear infinite;
        }
        @keyframes gridMove { 0% { transform: perspective(300px) rotateX(40deg) translateY(0); } 100% { transform: perspective(300px) rotateX(40deg) translateY(40px); } }

        .nebula {
            position: absolute; border-radius: 50%; filter: blur(100px); opacity: 0.4;
            mix-blend-mode: screen; animation: float 30s infinite ease-in-out alternate;
            will-change: transform;
        }
        .nebula-1 { width: 500px; height: 500px; background: var(--neon-purple); top: -100px; left: -100px; }
        .nebula-2 { width: 400px; height: 400px; background: var(--neon-blue); bottom: -50px; right: -50px; animation-delay: -5s; }
        
        @keyframes float { 0% { transform: translate(0, 0); } 100% { transform: translate(30px, 50px); } }

        /* --- HEADER --- */
        header {
            flex: 0 0 80px; display: flex; justify-content: space-between; align-items: center;
            padding: 0 15px; background: rgba(8, 8, 21, 0.9); backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1); z-index: 10;
            position: relative;
        }

        .level-info { display: flex; flex-direction: column; align-items: center; }
        .rank-badge { font-size: 0.7rem; color: var(--neon-pink); font-weight: 700; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 2px; }
        .level-badge { font-size: 1.1rem; color: #fff; font-weight: 800; }
        .level-num { color: var(--neon-blue); }
        .word-len-badge { font-size: 0.7rem; color: #888; letter-spacing: 0.5px; margin-top: 2px; }

        .header-right { display: flex; gap: 8px; align-items: center; }

        .gold-display {
            background: rgba(255, 255, 255, 0.05); border: 1px solid var(--neon-yellow); color: var(--neon-yellow);
            padding: 5px 12px; border-radius: 20px; font-weight: 700; font-size: 0.9rem;
            display: flex; align-items: center; gap: 5px;
        }

        .icon-btn {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: #fff; width: 40px; height: 40px; border-radius: 12px;
            display: flex; justify-content: center; align-items: center;
            font-size: 1.1rem; cursor: pointer; transition: all 0.2s; position: relative;
        }
        .icon-btn:hover { background: rgba(255,255,255,0.15); border-color: var(--neon-blue); }
        
        /* Buton √ñzel Renkleri */
        .btn-bomb:hover { border-color: var(--neon-red); color: var(--neon-red); background: rgba(255, 42, 42, 0.1); }
        .btn-surrender:hover { border-color: #888; color: #ccc; background: rgba(255,255,255,0.1); }

        .muted-line { position: absolute; width: 2px; height: 20px; background: var(--neon-red); transform: rotate(45deg); display: none; }
        .muted .muted-line { display: block; }

        /* Timer Bar */
        .time-bar-container { position: absolute; bottom: 0; left: 0; width: 100%; height: 3px; background: rgba(255,255,255,0.1); }
        .time-bar { height: 100%; background: var(--neon-blue); width: 100%; box-shadow: 0 0 10px var(--neon-blue); transition: width linear; }

        /* --- OYUN ALANI --- */
        #game-area { flex: 1; display: flex; justify-content: center; align-items: center; padding: 10px; z-index: 5; }
        
        #board { display: grid; gap: 8px; }
        .row { display: grid; gap: 8px; }

        .tile {
            width: var(--tile-size); height: var(--tile-size);
            background: var(--tile-glass); border: 2px solid var(--tile-border);
            border-radius: 10px; display: flex; justify-content: center; align-items: center;
            font-size: 2rem; font-weight: 700; color: #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); 
            transition: transform 0.1s, border-color 0.2s, background-color 0.2s; 
            will-change: transform, background-color; 
        }

        .tile[data-state="active"] {
            border-color: var(--neon-blue);
            background: rgba(0, 243, 255, 0.05);
            box-shadow: 0 0 15px var(--tile-active-glow);
            transform: scale(1.03);
            animation: tilePulse 0.3s ease-out;
        }

        @keyframes tilePulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); border-color: #fff; }
            100% { transform: scale(1.03); }
        }
        
        /* Oto doldurulan harf animasyonu */
        .tile[data-state="autofilled"] {
            animation: pulseGreen 0.5s ease-out;
            border-color: rgba(10, 255, 104, 0.5);
            color: var(--neon-green);
        }

        @keyframes pulseGreen {
            0% { transform: scale(1); box-shadow: 0 0 0 rgba(10, 255, 104, 0); }
            50% { transform: scale(1.1); box-shadow: 0 0 20px rgba(10, 255, 104, 0.4); }
            100% { transform: scale(1); box-shadow: 0 0 0 rgba(10, 255, 104, 0); }
        }

        .tile.flip { transform: rotateX(90deg); transition: transform 0.4s ease-in; }
        
        .tile.correct { background: var(--neon-green) !important; border-color: var(--neon-green) !important; color: #000 !important; box-shadow: 0 0 15px var(--neon-green); }
        .tile.present { background: var(--neon-yellow) !important; border-color: var(--neon-yellow) !important; color: #000 !important; box-shadow: 0 0 15px var(--neon-yellow); }
        .tile.absent { background: var(--absent-bg) !important; border-color: transparent !important; color: var(--absent-text) !important; opacity: 1 !important; box-shadow: none !important; }

        /* Shake Animasyonu */
        .shake { animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translateX(-2px); } 20%, 80% { transform: translateX(2px); } 30%, 50%, 70% { transform: translateX(-4px); } 40%, 60% { transform: translateX(4px); } }

        /* --- KLAVYE --- */
        #keyboard-container { width: 100%; max-width: 600px; margin: 0 auto; padding: 5px 5px 25px 5px; z-index: 10; }
        .kb-row { display: flex; width: 100%; justify-content: center; gap: 5px; margin-bottom: 6px; }
        .key {
            flex: 1; height: 58px; border-radius: 8px; border: none;
            background: rgba(45, 45, 65, 0.9); border-bottom: 3px solid rgba(0,0,0,0.3);
            color: #fff; font-weight: 700; font-size: 1.2rem;
            cursor: pointer; transition: background-color 0.15s;
            touch-action: manipulation;
        }
        .key:active { transform: translateY(2px); border-bottom: 0; background: rgba(255,255,255,0.15); }
        .key-wide { flex: 1.4; font-size: 0.95rem; background: rgba(60, 60, 80, 0.9); }
        
        .key.correct { background: var(--correct); color: #000; border:none; box-shadow: 0 0 10px var(--correct); }
        .key.present { background: var(--present); color: #000; border:none; box-shadow: 0 0 10px var(--present); }
        .key.absent { background: var(--absent-bg); color: var(--absent-text); border:none; opacity: 0.5; pointer-events: none; }

        /* --- MODALS --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(8px);
            display: none; justify-content: center; align-items: center; z-index: 100;
        }
        .modal-content {
            background: #121220; border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 0 40px rgba(0,0,0,0.5);
            padding: 30px; border-radius: 20px; text-align: center;
            min-width: 320px; max-width: 90%; animation: zoomIn 0.3s;
            position: relative;
        }
        .close-btn { position: absolute; top: 15px; right: 20px; background: none; border: none; color: #fff; font-size: 1.2rem; cursor: pointer; opacity: 0.7; }
        .close-btn:hover { opacity: 1; }
        
        .stat-row { display: flex; justify-content: space-around; margin: 25px 0; background: rgba(255,255,255,0.03); padding: 15px; border-radius: 12px; }
        .stat-item { display: flex; flex-direction: column; }
        .stat-val { font-size: 1.6rem; font-weight: 900; color: var(--neon-blue); }
        .stat-label { font-size: 0.75rem; color: #999; text-transform: uppercase; letter-spacing: 1px; margin-top: 5px; }

        .btn-primary {
            background: var(--neon-blue); color: #000; border: none;
            padding: 16px 45px; border-radius: 50px; font-size: 1.1rem; font-weight: 800; letter-spacing: 1px;
            margin-top: 20px; cursor: pointer; box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
            transition: transform 0.2s; width: 100%;
        }
        .btn-primary:hover { transform: scale(1.03); box-shadow: 0 0 30px rgba(0, 243, 255, 0.5); }

        #toast-container { position: fixed; top: 100px; left: 50%; transform: translateX(-50%); z-index: 200; pointer-events: none; width: 80%; display: flex; flex-direction: column; align-items: center; }
        .toast {
            background: #fff; color: #000; padding: 12px 25px; border-radius: 30px;
            font-weight: 800; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: slideUp 0.3s forwards; margin-bottom: 8px; white-space: nowrap;
        }
        .toast.error { background: var(--neon-red); color: #fff; }
        
        #confetti-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 90; }

        @keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @media (max-width: 380px) { .key { height: 50px; font-size: 1rem; } :root { --tile-size: 48px; } }
    </style>
</head>
<body>

    <!-- ARKA PLAN -->
    <div class="universe">
        <div class="grid-overlay"></div>
        <div class="nebula nebula-1"></div>
        <div class="nebula nebula-2"></div>
    </div>

    <!-- HEADER -->
    <header>
        <button class="icon-btn btn-surrender" onclick="surrender()" title="Pes Et">üè≥Ô∏è</button>
        
        <div class="level-info">
            <div id="rank-display" class="rank-badge">G√ñZC√ú</div>
            <div class="level-badge">SEVƒ∞YE <span id="level-display" class="level-num">1</span></div>
            <div id="word-len-display" class="word-len-badge">3 HARFLƒ∞</div>
        </div>

        <div class="header-right">
            <div class="gold-display"><span>‚ö°</span> <span id="gold-display">0</span></div>
            <button class="icon-btn btn-bomb" onclick="eliminateKeys()" title="3 Yanlƒ±≈ü Harfi Elet (-75)">üí£</button>
            <button class="icon-btn" onclick="useHint()" title="ƒ∞pucu (-50)">üí°</button>
            <button class="icon-btn" id="mute-btn" onclick="toggleMute()">
                üîä<div class="muted-line"></div>
            </button>
        </div>
        <div class="time-bar-container"><div id="time-bar" class="time-bar"></div></div>
    </header>

    <canvas id="confetti-canvas"></canvas>
    <div id="toast-container"></div>

    <!-- OYUN ALANI -->
    <div id="game-area">
        <div id="board"></div>
    </div>
    <div id="keyboard-container"></div>

    <!-- SONU√á MODALI -->
    <div id="result-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 id="modal-title" style="margin:0 0 5px 0; font-size: 2rem; letter-spacing:1px;"></h2>
            <div style="display:flex; justify-content:center; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:15px;">
                <div id="modal-reward" style="font-size:1.1rem; color:var(--neon-yellow); font-weight:700;"></div>
                <div id="time-bonus" style="font-size:0.9rem; background:rgba(0, 243, 255, 0.1); color:var(--neon-blue); padding:4px 10px; border-radius:10px; border:1px solid var(--neon-blue); display:none;"></div>
            </div>
            <div id="modal-emoji" style="font-size:4rem; margin:10px 0;"></div>
            <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; margin:20px 0;">
                <div style="color:#aaa; font-size:0.8rem; letter-spacing:1px; margin-bottom:5px;">KELƒ∞ME</div>
                <div id="word-reveal" style="color:#fff; font-size: 1.8rem; font-weight:900; letter-spacing:3px;"></div>
            </div>
            <button class="btn-primary" onclick="nextLevel()">DEVAM ET</button>
        </div>
    </div>

    <!-- ƒ∞STATƒ∞STƒ∞K MODALI -->
    <div id="stats-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn" onclick="closeModal('stats-modal')">‚úï</button>
            <h2 style="color:#fff; margin-bottom:5px;">ƒ∞STATƒ∞STƒ∞KLER</h2>
            <div id="stat-rank-title" style="color:var(--neon-pink); font-size:0.9rem; margin-bottom:10px; letter-spacing:2px; font-weight:700;">G√ñZC√ú</div>
            
            <div class="stat-row">
                <div class="stat-item"><span class="stat-val" id="stat-played">0</span><span class="stat-label">Oyun</span></div>
                <div class="stat-item"><span class="stat-val" id="stat-win">0</span><span class="stat-label">Zafer</span></div>
                <div class="stat-item"><span class="stat-val" id="stat-rate">0%</span><span class="stat-label">Ba≈üarƒ±</span></div>
            </div>
            <div class="stat-row" style="margin-top:10px;">
                <div class="stat-item"><span class="stat-val" id="stat-streak">0</span><span class="stat-label">Seri</span></div>
                <div class="stat-item"><span class="stat-val" id="stat-max">0</span><span class="stat-label">Rekor</span></div>
            </div>
        </div>
    </div>

    <!-- YARDIM MODALI -->
    <div id="help-modal" class="modal-overlay">
        <div class="modal-content" style="text-align: left;">
            <button class="close-btn" onclick="closeModal('help-modal')">‚úï</button>
            <h2 style="text-align:center; color:var(--neon-blue);">NASIL OYNANIR?</h2>
            <p style="color:#ccc; text-align:center; margin-bottom:20px;">Kelimeler 3'ten 7 harfe kadar uzar, sonra d√∂ng√º ba≈üa d√∂ner.</p>
            
            <div style="margin:10px 0; padding:12px; border-left:4px solid var(--neon-green); background:rgba(255,255,255,0.03); border-radius:0 8px 8px 0;">
                <span style="color:var(--neon-green); font-weight:bold;">YE≈ûƒ∞L</span> harf doƒüru yerde.
                <br><span style="font-size:0.8rem; color:#aaa; margin-top:4px; display:block;">(Sonraki satƒ±rda otomatik belirir!)</span>
            </div>
            <div style="margin:10px 0; padding:12px; border-left:4px solid var(--neon-yellow); background:rgba(255,255,255,0.03); border-radius:0 8px 8px 0;">
                <span style="color:var(--neon-yellow); font-weight:bold;">SARI</span> harf kelimede var ama yeri yanlƒ±≈ü.
            </div>
            <div style="margin:10px 0; padding:12px; border-left:4px solid #777; background:rgba(255,255,255,0.03); border-radius:0 8px 8px 0;">
                <span style="color:#999; font-weight:bold;">GRƒ∞</span> harf kelimede yok.
            </div>
            <p style="font-size:0.85rem; color:var(--neon-blue); text-align:center; margin-top:20px;">üí£ Bomba ile yanlƒ±≈ü harfleri eleyebilirsin!</p>
        </div>
    </div>

    <!-- G√úNL√úK √ñD√úL MODALI -->
    <div id="daily-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="color:var(--neon-yellow);">G√úNL√úK √ñD√úL</h2>
            <div style="font-size:4rem; margin:20px 0;">üéÅ</div>
            <div style="font-size:1.3rem; color:#fff; font-weight:bold;">+50 ENERJƒ∞ KAZANDIN</div>
            <button class="btn-primary" onclick="claimDaily()">TE≈ûEKK√úRLER</button>
        </div>
    </div>

<script>
    // --- VERƒ∞TABANI & AYARLAR ---
    const STORAGE_KEY = 'kelime_neon_v6_1';
    
    // SADECE T√úRK√áE HARFLƒ∞ KELƒ∞MELER Lƒ∞STESƒ∞
    // Q, W, X harfleri i√ßerenler temizlendi. 
    const DB = {
        3: [
            "A≈ûK", "TOP", "NAR", "MUZ", "G√ñZ", "YAZ", "KI≈û", "√áAY", "NEY", "KOL", 
            "TUZ", "BAƒû", "Cƒ∞N", "Fƒ∞≈û", "G√ú√á", "RAF", "K√úP", "S√úT", "KAN", "CEM", 
            "BOT", "KOD", "RAM", "≈ûAL", "YOL", "HIZ", "Pƒ∞L", "ADA", "ATA", "ARA",
            "Bƒ∞R", "Bƒ∞Z", "BOY", "BUZ", "CAM", "√áAN", "DAƒû", "DAM", "Dƒ∞≈û", "EDA",
            "ELA", "FAL", "Fƒ∞L", "GOL", "G√úL", "HAN", "HAT", "HUY", "ISI", "ƒ∞Yƒ∞",
            "KA≈û", "KAT", "KIR", "KIZ", "KU≈û", "MA√á", "MAT", "MEY", "NAL", "NAM",
            "ODA", "OYA", "PAY", "PEK", "POT", "RAY", "ROL", "RUH", "SA√á", "SAF",
            "SAƒû", "SEL", "SES", "Sƒ∞S", "SON", "≈ûAN", "≈ûEF", "TA√á", "TA≈û", "TAT",
            "TAY", "TEK", "TEL", "TIR", "TOS", "TOZ", "T√úR", "VAN", "VAR", "YAD",
            "YAƒû", "YAN", "YA≈û", "YAY", "YIL", "YOK", "Y√úN", "Y√úZ", "ZAM", "ZAR"
        ],
        4: [
            "ELMA", "KAPI", "MAVƒ∞", "FARE", "OKUL", "KEDƒ∞", "YURT", "SERT", "KALE", 
            "√úZ√úM", "UZAY", "NEON", "VERƒ∞", "KODU", "DERT", "MART", "BANK", 
            "AKIM", "LENS", "TEST", "PLAN", "A√áIK", "ADIM", "AƒûA√á", "Aƒ∞LE", 
            "AKIL", "ALAN", "ALET", "AMA√á", "ANIT", "ARAC", "ARZU", "ASIR",
            "A≈û√áI", "ATE≈û", "ATOM", "AYNA", "BABA", "BATI", "BEBE", "Bƒ∞NA", "BOR√á",
            "BOYA", "CUMA", "√áATI", "DANS", "DERS", "DERƒ∞", "DOƒûA", "DOST", "KUTU",
            "DRAM", "EKƒ∞M", "EMEK", "ERƒ∞K", "E≈ûYA", "ETKƒ∞", "EVRE", "Fƒ∞LM",
            "FORM", "FOTO", "GEMƒ∞", "GERƒ∞", "GEZƒ∞", "GIDA", "GRAM", "GRUP", "HALK",
            "HATA", "HAVA", "HOBƒ∞", "ƒ∞ADE", "ƒ∞LA√á", "ƒ∞LKE", "ƒ∞MZA", "ƒ∞Sƒ∞M", "KAFE",
            "KAMP", "KAOS", "KATI", "KAYA", "KE√áƒ∞", "KENT", "KISA", "Kƒ∞LO", "Kƒ∞RA",
            "KLAN", "KLƒ∞P", "KOCA", "KONU", "KO≈ûU", "KOYU", "KRAL", "KREM", "KURT",
            "KURU", "KUYU", "Lƒ∞RA", "LOGO", "MAA≈û", "MANA", "MAR≈û", "MASA",
            "MAYA", "MEN√ú", "MERA", "MERT", "MODA", "MOLA", "M√úZE", "OCAK",
            "ODAK", "OLAY", "ONAY", "ORAN", "ORU√á", "OTEL", "OYUN", "√ñDEV", "√ñL√á√ú",
            "√ñYK√ú", "√ñZEL", "√ñZET", "PARA", "PARK", "PA≈ûA", "PERƒ∞", "Pƒ∞ST", "PLAK",
            "PUAN", "RENK", "Rƒ∞SK", "R√úYA", "SAAT", "SADE", "SAHA", "SARI", "SAYI",
            "SIRA", "SORU", "SPOR", "STƒ∞L", "≈ûAKA", "≈ûANS", "≈ûART", "≈ûƒ∞ƒ∞R", "≈ûUBE", 
            "TAHT", "TANK", "TAPU", "TART", "TAZE", "TEMA", "TERK", "TREN", "ULA≈û", 
            "UMUT", "√úR√úN", "√úNL√ú", "VADE", "VALƒ∞", "Vƒ∞DA", "Vƒ∞ZE", "YAPI", "YARA", 
            "YARI", "YENƒ∞", "YOGA", "ZEKA", "Lƒ∞NK"
        ],
        5: [
            "RADYO", "SEHPA", "Kƒ∞TAP", "√áƒ∞√áEK", "D√úNYA", "M√úZƒ∞K", "KAHVE", "BULUT", 
            "G√úNE≈û", "ROBOT", "LAZER", "EKRAN", "MOBƒ∞L", "KABLO", "MOTOR", "HELVA", 
            "MODEM", "Sƒ∞BER", "PANEL", "Vƒ∞DEO", "AJANS", "ABƒ∞DE", "ACABA", "ACELE",
            "ADRES", "AK≈ûAM", "ALARM", "ALB√úM", "ALKI≈û", "ANLAM", "ANKET", "ANTEN",
            "ARABA", "ARIZA", "BAH√áE", "BALIK", "BANKA", "BANYO", "PARTƒ∞",
            "BARI≈û", "BASIN", "BA≈ûAK", "BEBEK", "BEDEL", "BELGE", "BEYAZ", "Bƒ∞BER",
            "Bƒ∞LET", "Bƒ∞LGƒ∞", "Bƒ∞Lƒ∞M", "B√ñLGE", "B√ñL√úM", "B√úT√áE", "B√úY√úK", "CAMƒ∞A",
            "CANLI", "CEVAP", "CEVƒ∞Z", "Cƒ∞HAZ", "√áADIR", "√áANTA", "√áEKƒ∞√á", "√áELƒ∞K",
            "√áE≈ûƒ∞T", "√áƒ∞ZGƒ∞", "√áORAP", "DAƒ∞RE", "DAMAR", "DAMLA", "DAVET", "DENƒ∞Z",
            "DETAY", "DEVƒ∞R", "Dƒ∞REK", "DOƒûRU", "DOLAP", "DOSYA", "D√ñVƒ∞Z", "DURAK",
            "DURUM", "DUVAR", "D√úƒû√úN", "EDEBƒ∞", "EFEKT", "EJDER", "EKMEK",
            "ELMAS", "EMLAK", "ENGEL", "ESNAF", "ETƒ∞KET", "EYLEM", "FAKƒ∞R", "FATƒ∞H",
            "FAYDA", "Fƒ∞DAN", "Fƒ∞Kƒ∞R", "Fƒ∞RMA", "Fƒ∞Zƒ∞K", "FORMA", "GENEL", "Gƒ∞Rƒ∞≈û",
            "Gƒ∞TAR", "Gƒ∞Yƒ∞M", "G√ñLGE", "G√ñREV", "G√úZEL", "HABER", "HAFTA", "HAKLI",
            "HALKA", "HAMLE", "HANGƒ∞", "HARƒ∞TA", "HASAR", "HAYAL", "HAYAT", "HEDEF",
            "HEKƒ∞M", "HESAP", "HEYET", "HIZLI", "HUKUK", "H√úCRE", "HUZUR", "ƒ∞BARE",
            "ƒ∞√áERƒ∞", "ƒ∞DEAL", "ƒ∞FADE", "ƒ∞KLƒ∞M", "ƒ∞MKAN", "ƒ∞NSAN", "ƒ∞PTAL", 
            "ƒ∞SLAM", "ƒ∞≈ûLEM", "KAƒûIT", "KALEM", "KAMER", "KANAL", "KANIT", "KARGO",
            "KA≈ûIK", "KAYIP", "KAYIT", "KAZAN", "KEBAP", "KENAR", "KESƒ∞N", "KIVAM",
            "Kƒ∞MYA", "Kƒ∞RAZ", "KLƒ∞MA", "KOLAY", "KONUK", "KONUM", "KOPYA", "KORKU",
            "KREDƒ∞", "KURAL", "KURUL", "KURUM", "KUZEY", "Lƒ∞DER", "Lƒ∞MAN", "Lƒ∞STE",
            "MAHAL", "MAKAM", "MAKAS", "MANTI", "MARKA", "MASAL", "MEDYA", "MEKAN",
            "MESAJ", "METAL", "METƒ∞N", "METRO", "Mƒ∞MAR", "Mƒ∞RAS", "MODEL", "Nƒ∞YET",
            "NOKTA", "N√ñBET", "NUMARA", "ORTAM", "√ñRDEK", "√ñRNEK",
            "√ñZLEM", "PAKET", "PAMUK", "PANƒ∞K", "PAR√áA", "PAZAR", "PEMBE",
            "PERDE", "Pƒ∞LOT", "Pƒ∞YON", "PLAZA", "POLƒ∞S", "PROJE", "RAKƒ∞P", "RAPOR",
            "RESƒ∞M", "ROMAN", "ROKET", "SABAH", "SAHƒ∞L", "SAHNE", "SAKƒ∞N", "SALON",
            "SANAL", "SANAT", "SANKƒ∞", "SARAY", "SATI≈û", "SEBEP", "SEBZE", "SE√áƒ∞M",
            "SEKƒ∞Z", "SELAM", "SENET", "SERGƒ∞", "SERVƒ∞", "SESLƒ∞", "SEZON",
            "SICAK", "SINAV", "SINIF", "SINIR", "Sƒ∞LAH", "Sƒ∞MYA", "Sƒ∞NEK", "Sƒ∞REN",
            "Sƒ∞TEM", "Sƒ∞Vƒ∞L", "Sƒ∞YAH", "SOKAK", "SONU√á", "SORUN", "S√ñZL√ú", "SUBAY",
            "S√úRE√á", "S√úR√úM", "≈ûAHƒ∞T", "≈ûARKI", "≈ûEHƒ∞R", "≈ûEKER", "≈ûEKƒ∞L", "TABAK",
            "TABAN", "TABLO", "TAKIM", "TAKƒ∞P", "TALEB", "TALƒ∞H", "TAMƒ∞R", "TARAF",
            "TARIM", "TARƒ∞H", "TARLA", "TAVUK", "TEKNE", "TEMEL", "TEMƒ∞Z", "TEPSƒ∞",
            "TERZƒ∞", "T√ñREN", "TUTAR", "T√úNEL", "UCUBE", "UZMAN",
            "√úCRET", "√ú√áGEN", "√úNƒ∞TE", "√úNVAN", "√úST√úN", "VAKIF", "VAKƒ∞T", "VARƒ∞L",
            "VARLIK", "VATAN", "VERGƒ∞", "Vƒ∞R√úS", "Vƒ∞ZON", "VAGON", "YAKIN", "YALAN",
            "YANIT", "YANKI", "YARAR", "YASAL", "YA≈ûAM", "YATAK", "YAYIN", "YAZAR",
            "YEMEK", "YEREL", "YE≈ûƒ∞L", "Yƒ∞ƒûƒ∞T", "YOKSA", "YORUM", "Y√úZDE",
            "ZAMAN", "ZEMƒ∞N", "Zƒ∞RVE", "ZORLU"
        ],
        6: [
            "KAPTAN", "G√ñZL√úK", "BARDAK", "KOLTUK", "YASTIK", "Z√úRAFA", "BALKON", 
            "KARPUZ", "Sƒ∞STEM", "SERVER", "MATRƒ∞S", "PLANET", "SINYAL", "SOHBET",
            "KRƒ∞PTO", "AVATAR", "ENERJƒ∞", "PUSULA", "SEKT√ñR", "ADALET", "AKARSU", 
            "AKRABA", "AMAZON", "ANONƒ∞M", "ANTƒ∞KA", "ARALIK", "ARITMA", "ASKERƒ∞", 
            "AT√ñLYE", "AVUKAT", "AYARLA", "BADANA", "BAKKAL", "BALƒ∞NA", "BALYOZ", 
            "BANKER", "BARAJ", "BAYRAK", "BAYRAM", "BEƒûENƒ∞", "BENZƒ∞N", "BERBER", 
            "BA≈ûKAN", "Bƒ∞LDƒ∞R", "BONCUK", "BO≈ûLUK", "BULVAR", "BUR√áAK", "B√úLB√úL", 
            "CETVEL", "CEYLAN", "C√ñMERT", "√áAR≈ûAF", "√áEYREK", "√áIPLAK", "√á√ñMLEK", 
            "DAKƒ∞KA", "DANTEL", "DEFTER", "DEPREM", "DERMAN", "DERNEK", "DESTEK", 
            "DEVLET", "DEVRƒ∞M", "DI≈ûARI", "Dƒ∞KKAT", "Dƒ∞REKT", "DOKTOR", "DOMƒ∞NO", 
            "D√úRB√úN", "D√úR√úST", "ECZANE", "EFENDƒ∞", "Eƒûƒ∞Tƒ∞M", "ELBƒ∞SE", "EMEKLƒ∞", 
            "ENDEKS", "ERƒ∞≈ûƒ∞M", "ETKƒ∞Lƒ∞", "FAKT√ñR", "FISTIK", "Fƒ∞NANS", "FIRSAT", 
            "FORM√úL", "FUKARA", "FUTBOL", "GARSON", "GAZETE", "GE√áMƒ∞≈û", "GER√áEK", 
            "G√ñMLEK", "G√úNCEL", "G√úNDEM", "HARƒ∞KA", "HASRET", "HASSAS", "HATIRA", 
            "HAYVAN", "HAZƒ∞NE", "HEYKEL", "Hƒ∞ZMET", "ƒ∞√áECEK", "ƒ∞LGƒ∞N√á", "ƒ∞≈ûARET", 
            "KAFƒ∞YE", "KALƒ∞TE", "KAMERA", "KANSER", "KAPLAN", "KARDE≈û", "KARTAL", 
            "KARTON", "KASABA", "KAYNAK", "KELƒ∞ME", "KESKƒ∞N", "KLASƒ∞K", "KLAVYE", 
            "KOMEDƒ∞", "KOMPLE", "KONFOR", "KONGRE", "KONSER", "KONTAK", "KORKAK", 
            "KORSAN", "KRƒ∞TER", "KRONƒ∞K", "KUL√úBE", "KUVVET", "K√úLT√úR", "LASTƒ∞K", 
            "LEOPAR", "MADENƒ∞", "MAƒûAZA", "MAKALE", "MAKƒ∞NE", "MANTAR", "MANTIK", 
            "MARKET", "MASRAF", "MATKAP", "MECBUR", "MERCEK", "MERKEZ", "MESLEK", 
            "MEVCUT", "MEYDAN", "Mƒ∞KTAR", "Mƒ∞LLET", "Mƒ∞LYON", "MODERN", "MUHTAR", 
            "MUTFAK", "NEREDE", "NESNEL", "NORMAL", "NUMUNE", "ONARIM", "PANJUR", 
            "PARF√úM", "PARLAK", "PARMAK", "PATRON", "PAYLA≈û", "PE√áETE", "PENDƒ∞K", 
            "PETROL", "PEYNƒ∞R", "Pƒ∞YASA", "PLANLI", "PORTAL", "POSTAL", "PROFƒ∞L", 
            "RE√áETE", "REHBER", "REKLAM", "RENKLƒ∞", "RESMƒ∞", "R√úZGAR", "SAƒûLIK", 
            "SAMƒ∞Mƒ∞", "SANDAL", "SANƒ∞YE", "SANS√úR", "SARMAL", "SATICI", "SAYDAM", 
            "SE√áKƒ∞N", "SEMBOL", "SENTEZ", "SEVƒ∞YE", "Sƒ∞GARA", "Sƒ∞NYAL", 
            "SOSYAL", "S√ñZL√úK", "S√úLF√úR", "S√úNGER", "S√úR√úC√ú", "≈ûABLON", "≈ûEFFAF", 
            "≈ûƒ∞M≈ûEK", "≈ûƒ∞RKET", "TABLET", "TAHMƒ∞N", "TAKVƒ∞M", "TALEBE", "TASARI", 
            "TATƒ∞L", "TEHLƒ∞K", "TEKNƒ∞K", "TEKRAR", "TEMSƒ∞L", "TERCƒ∞H", "TERMAL", 
            "TESLƒ∞M", "TOPLAM", "TOPLUM", "TOPRAK", "TURƒ∞ZM", "ULUSAL", "UZANTI", 
            "√úRETƒ∞M", "√ú√áGEN", "Vƒ∞CDAN", "Vƒ∞DEO", "Vƒ∞ZYON", "VOLKAN", "YALNIZ", 
            "YAPRAK", "YARDIM", "YAYGIN", "YAZICI", "YELKEN", "YEMEK", "YENGE√á", 
            "YETKƒ∞N", "YILDIZ", "YOƒûURT", "Y√ñNTEM", "Y√úKSEK", "ZABITA", "ZAMANE", 
            "ZEYTƒ∞N", "Zƒ∞NCƒ∞R"
        ],
        7: [
            "MERHABA", "PENCERE", "T√úRKƒ∞YE", "TELEFON", "MANZARA", "J√úPƒ∞TER", 
            "YAZILIM", "MONƒ∞T√ñR", "ƒ∞LETƒ∞≈ûƒ∞", "Dƒ∞YALOG", "Dƒ∞Jƒ∞TAL", "PROGRAM", 
            "Y√ñNETƒ∞M", "AKADEMƒ∞", "AKSƒ∞YON", "AMBALAJ", "ANATOMƒ∞", "ANLA≈ûMA", 
            "ANTALYA", "ARABACI", "ARKADA≈û", "AVANTAJ", "AYRINTI", 
            "BATARYA", "BEKLEME", "Bƒ∞YOLOG", "BULMACA", "√áALI≈ûMA", 
            "√áAMA≈ûIR", "√áEKƒ∞RGE", "√áEVRECƒ∞", "DANI≈ûMA", "DENKLEM", "DERSANE", 
            "Dƒ∞NAMƒ∞K", "Dƒ∞PLOMA", "DOKUMAN", "D√ú≈û√úNCE", "D√úZENLƒ∞", 
            "EƒûLENCE", "EKOLOJƒ∞", "EKONOMƒ∞", "EMNƒ∞YET", "ENERJƒ∞K", "ERZURUM", 
            "FABRƒ∞KA", "FANTAZƒ∞", "FASULYE", "FELAKET", "FELSEFE", "FIRTINA", 
            "FREKANS", "GALAKSƒ∞", "GARANTƒ∞", "GECELƒ∞K", "GELECEK", "GELENEK", 
            "GEN√áLƒ∞K", "GENETƒ∞K", "GERƒ∞Lƒ∞M", "G√ñKY√úZ√ú", "G√ñSTERƒ∞", "G√úVENLƒ∞", 
            "HABERCƒ∞", "HAKƒ∞KAT", "HAREKET", "HASTANE", "HEYECAN", "ISPANAK", 
            "ƒ∞HRACAT", "ƒ∞HTƒ∞MAL", "ƒ∞HTƒ∞YA√á", "ƒ∞NCELƒ∞K", "ƒ∞SKELET", "ƒ∞TFAƒ∞YE", 
            "JENERƒ∞K", "KARINCA", "KAVRAMA", "KELEBEK", "KERESTE", "KILAVUZ", 
            "KIRMIZI", "Kƒ∞RALIK", "KOMANDO", "KOMEDYA", "KOMUTAN", "KONTROL", 
            "KORƒ∞DOR", "KRƒ∞STAL", "MALZEME", "MANZARA", "MARATON", 
            "MEDƒ∞KAL", "MEKANƒ∞K", "MENEK≈ûE", "MERKEZƒ∞", "MOBƒ∞LYA", "MUHABƒ∞R", 
            "M√úZƒ∞KAL", "NAKLƒ∞YE", "NEGATƒ∞F", "Nƒ∞L√úFER", "OKYANUS", "ORGANƒ∞K", 
            "OYUNCUK", "PALMƒ∞YE", "PAPAƒûAN", "PAPATYA", "PARALEL", "PATATES", 
            "PIRLANTA", "Pƒ∞RAMƒ∞T", "Pƒ∞YANGO", "POZƒ∞Tƒ∞F", "PRENSƒ∞P", "PROBLEM", 
            "RANDEVU", "REKABET", "SAATLER", "SABIRLI", "SANAT√áI", "SANTRAL", 
            "SATILIK", "SATRAN√á", "SAYISAL", "SE√áENEK", "SEMƒ∞NER", "SENARYO", 
            "SENDƒ∞KA", "SERAMƒ∞K", "SERBEST", "Sƒ∞GORTA", "Sƒ∞METRƒ∞", "Sƒ∞YASET", 
            "STADYUM", "S√úRPRƒ∞Z", "≈ûEMSƒ∞YE", "≈û√ñVALYE", "TAAHH√úT", "TASARIM", 
            "TAVSƒ∞YE", "TEHLƒ∞KE", "TENCERE", "TERBƒ∞YE", "TESTERE", "Tƒ∞YATRO", 
            "TOPLANT", "TRAKT√ñR", "TRABZON", "T√úKETƒ∞M", "T√úRKƒ∞YE", "U√áURTMA", 
            "UYGULAM", "√úRETƒ∞Cƒ∞", "√úR√úNLER", "Vƒ∞TAMƒ∞N", "YABANCI", "YARI≈ûMA", 
            "YA≈ûAMAK", "YATIRIM", "YAZILIM", "YELPAZE", "YETENEK", "Y√ñNETƒ∞M", 
            "Y√ñNETME", "YUMURTA", "YUVARLA", "Zƒ∞YARET"
        ]
    };
    const THEMES = ["uzay", "orman", "okyanus", "volkan"];
    
    // R√ºtbe Sistemi (Daha profesyonel)
    const RANKS = [
        { l: 0, t: "G√ñZC√ú" },
        { l: 5, t: "KA≈ûƒ∞F" },
        { l: 10, t: "OPERAT√ñR" },
        { l: 20, t: "TEKNƒ∞SYEN" },
        { l: 35, t: "Sƒ∞BER UZMAN" },
        { l: 50, t: "ELƒ∞T √úYE" },
        { l: 100, t: "EFSANE" }
    ];

    let gameState = {
        level: 1,
        gold: 100,
        stats: { played: 0, wins: 0, streak: 0, maxStreak: 0 },
        lastLogin: null,
        isMuted: false
    };
    
    let targetWord = "", wordLen = 3, currentGuess = [], remaining = 6, gameActive = true;
    let levelStartTime = 0;
    const HINT_COST = 50, BOMB_COST = 75, WIN_REWARD = 50, TIME_BONUS_LIMIT = 30000; // 30 sn bonus

    // --- SES EFEKTLERƒ∞ ---
    const AudioEngine = {
        ctx: new (window.AudioContext || window.webkitAudioContext)(),
        play(type) {
            if (gameState.isMuted) return;
            if (this.ctx.state === 'suspended') this.ctx.resume();
            const osc = this.ctx.createOscillator();
            const gain = this.ctx.createGain();
            const t = this.ctx.currentTime;
            
            if (type === 'click') {
                osc.type = 'sine'; osc.frequency.setValueAtTime(800, t);
                gain.gain.exponentialRampToValueAtTime(0.01, t + 0.05);
                osc.start(); osc.stop(t + 0.05);
            } else if (type === 'error') {
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(120, t);
                gain.gain.exponentialRampToValueAtTime(0.01, t + 0.15);
                osc.start(); osc.stop(t + 0.15);
            } else if (type === 'flip') {
                osc.type = 'triangle'; osc.frequency.setValueAtTime(400, t);
                gain.gain.setValueAtTime(0.05, t);
                gain.gain.linearRampToValueAtTime(0, t + 0.05);
                osc.start(); osc.stop(t + 0.05);
            } else if (type === 'pop') { 
                // Otomatik doldurma sesi (yumu≈üak)
                osc.type = 'sine'; osc.frequency.setValueAtTime(600, t);
                gain.gain.setValueAtTime(0.02, t);
                gain.gain.linearRampToValueAtTime(0, t + 0.1);
                osc.start(); osc.stop(t + 0.1);
            } else if (type === 'bomb') {
                // Bomba sesi (Daha kalƒ±n ve patlayƒ±cƒ±)
                osc.type = 'square'; osc.frequency.setValueAtTime(150, t);
                osc.frequency.exponentialRampToValueAtTime(40, t + 0.3);
                gain.gain.setValueAtTime(0.1, t);
                gain.gain.exponentialRampToValueAtTime(0.01, t + 0.3);
                osc.start(); osc.stop(t + 0.3);
            } else if (type === 'win') {
                [440, 554, 659, 880].forEach((f, i) => {
                    setTimeout(() => {
                        if(gameState.isMuted) return;
                        const o = this.ctx.createOscillator(); const g = this.ctx.createGain();
                        o.type = 'sine';
                        o.frequency.value = f; g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.3);
                        o.connect(g); g.connect(this.ctx.destination);
                        o.start(); o.stop(this.ctx.currentTime + 0.3);
                    }, i * 100);
                });
                return;
            }
            osc.connect(gain); gain.connect(this.ctx.destination);
        }
    };

    // --- OYUN FONKSƒ∞YONLARI ---
    function init() {
        loadGame();
        checkDailyBonus();
        createKeyboard();
        setupLevel();
        updateMuteIcon();
    }

    function loadGame() {
        const saved = localStorage.getItem(STORAGE_KEY);
        if(saved) {
            const parsed = JSON.parse(saved);
            gameState = { ...gameState, ...parsed };
        }
        updateUI();
    }
    function saveGame() { localStorage.setItem(STORAGE_KEY, JSON.stringify(gameState)); }

    function updateUI() {
        document.getElementById("level-display").textContent = gameState.level;
        document.getElementById("gold-display").textContent = gameState.gold;
        
        document.getElementById("stat-played").textContent = gameState.stats.played;
        document.getElementById("stat-win").textContent = gameState.stats.wins;
        document.getElementById("stat-streak").textContent = gameState.stats.streak;
        document.getElementById("stat-max").textContent = gameState.stats.maxStreak;
        
        const rate = gameState.stats.played > 0 ? Math.round((gameState.stats.wins / gameState.stats.played) * 100) : 0;
        document.getElementById("stat-rate").textContent = "%" + rate;

        const currentRank = RANKS.slice().reverse().find(r => gameState.level >= r.l) || RANKS[0];
        document.getElementById("rank-display").textContent = currentRank.t;
        document.getElementById("stat-rank-title").textContent = currentRank.t;
    }

    function toggleMute() {
        gameState.isMuted = !gameState.isMuted;
        updateMuteIcon();
        saveGame();
    }

    function updateMuteIcon() {
        const btn = document.getElementById("mute-btn");
        if(gameState.isMuted) btn.classList.add("muted");
        else btn.classList.remove("muted");
    }

    function checkDailyBonus() {
        const today = new Date().toDateString();
        if(gameState.lastLogin !== today) {
            setTimeout(() => openModal("daily-modal"), 500);
        }
    }

    function claimDaily() {
        const today = new Date().toDateString();
        gameState.gold += 50;
        gameState.lastLogin = today;
        saveGame();
        updateUI();
        closeModal("daily-modal");
        AudioEngine.play('win');
        showToast("+50 Enerji Eklendi!");
    }

    function setupLevel() {
        // D√∂ng√º: 3-4-5-6-7-3-4...
        wordLen = ((gameState.level - 1) % 5) + 3;
        
        document.getElementById("word-len-display").textContent = `${wordLen} HARFLƒ∞`;

        if (wordLen === 3 && gameState.level > 1) {
            setTimeout(() => showToast("‚ö° HIZLI TUR! ‚ö°"), 500);
        }

        const list = DB[wordLen] || DB[5];
        targetWord = list[Math.floor(Math.random() * list.length)];
        console.log("Hedef:", targetWord);

        const tIdx = (gameState.level - 1) % THEMES.length;
        if(tIdx > 0) document.body.setAttribute("data-theme", THEMES[tIdx]);
        else document.body.removeAttribute("data-theme");

        closeModal("result-modal");
        currentGuess = Array(wordLen).fill("");
        remaining = 6; gameActive = true;
        
        // Klavye renklerini sƒ±fƒ±rla
        document.querySelectorAll(".key").forEach(k => {
            k.className = "key";
            if(k.textContent === "Gƒ∞Rƒ∞≈û" || k.textContent === "‚å´") k.classList.add("key-wide");
        });
        
        createBoard(wordLen);
        startTimerAnimation();
    }

    function startTimerAnimation() {
        levelStartTime = Date.now();
        const bar = document.getElementById("time-bar");
        
        // Animasyonu sƒ±fƒ±rla
        bar.style.transition = 'none';
        bar.style.width = '100%';
        
        // Bir frame bekle ve ba≈ülat
        requestAnimationFrame(() => {
            requestAnimationFrame(() => {
                bar.style.transition = `width ${TIME_BONUS_LIMIT}ms linear`;
                bar.style.width = '0%';
            });
        });
    }

    function createBoard(len) {
        const board = document.getElementById("board"); board.innerHTML = "";
        let size = 60; 
        if(len === 6) size = 50; 
        if(len === 7) size = 44;
        
        document.documentElement.style.setProperty('--tile-size', size + 'px');
        
        for(let i=0; i<6; i++) {
            const row = document.createElement("div"); row.className = "row";
            row.style.gridTemplateColumns = `repeat(${len}, 1fr)`;
            for(let j=0; j<len; j++) {
                const tile = document.createElement("div"); tile.className = "tile";
                row.appendChild(tile);
            }
            board.appendChild(row);
        }
    }

    function createKeyboard() {
        const rows = ["E R T Y U I O P ƒû √ú", "A S D F G H J K L ≈û ƒ∞", "Enter Z C V B N M √ñ √á ‚å´"];
        const kb = document.getElementById("keyboard-container"); kb.innerHTML = "";
        rows.forEach(r => {
            const div = document.createElement("div"); div.className = "kb-row";
            r.split(" ").forEach(char => {
                const btn = document.createElement("button"); btn.className = "key"; btn.textContent = char;
                let val = char;
                if(char === "Enter" || char === "‚å´") {
                    btn.classList.add("key-wide");
                    if(char === "‚å´") { val = "Del"; btn.textContent = "‚å´"; }
                    if(char === "Enter") { btn.textContent = "Gƒ∞Rƒ∞≈û"; btn.style.fontSize="0.8rem"; }
                }
                btn.onclick = () => handleInput(val);
                div.appendChild(btn);
            });
            kb.appendChild(div);
        });
    }

    function handleInput(val) {
        if(!gameActive) return;
        
        if(val === "Enter") {
            submitGuess();
        } else if(val === "Del") {
            // Silme i≈ülemi (Editlenebilirlik i√ßin)
            let lastFilled = -1;
            // Tersten bakarak ilk dolu kutuyu bul ve sil
            for(let i = wordLen - 1; i >= 0; i--) {
                if(currentGuess[i] !== "") { lastFilled = i; break; }
            }
            if (lastFilled !== -1) {
                currentGuess[lastFilled] = "";
                updateActiveRow(lastFilled, ""); // UI g√ºncelle
                AudioEngine.play('click');
            }
        } else {
            // Harf ekleme
            let firstEmpty = currentGuess.indexOf("");
            if(firstEmpty !== -1) { 
                currentGuess[firstEmpty] = val; 
                updateActiveRow(firstEmpty, val); // UI g√ºncelle
                AudioEngine.play('click');
            }
        }
    }

    function updateActiveRow(index, val) {
        const row = document.querySelectorAll(".row")[6 - remaining];
        if(!row) return;
        const tile = row.children[index];
        tile.textContent = val;
        
        // Auto-filled style'ƒ± sil eƒüer kullanƒ±cƒ± deƒüi≈ütiriyorsa veya yazƒ±yorsa
        tile.removeAttribute("data-state");

        if(val !== "") {
            tile.setAttribute("data-state", "active");
        } else {
            tile.style.boxShadow = ""; 
            tile.style.borderColor = "";
            tile.style.transform = "";
            tile.style.animation = "";
        }
    }

    function updateActiveRowForAutofill(index, val) {
        // Otomatik doldurma i√ßin √∂zel g√∂rsel fonksiyon
        const row = document.querySelectorAll(".row")[6 - remaining];
        if(!row) return;
        const tile = row.children[index];
        tile.textContent = val;
        tile.setAttribute("data-state", "autofilled");
    }

    function shakeRow() {
        const row = document.querySelectorAll(".row")[6 - remaining];
        row.classList.remove("shake");
        void row.offsetWidth; // Trigger reflow
        row.classList.add("shake");
    }

    function submitGuess() {
        if(currentGuess.includes("")) { 
            showToast("Harf Eksik"); 
            AudioEngine.play('error'); 
            shakeRow();
            return; 
        }
        
        const guessStr = currentGuess.join("");
        const row = document.querySelectorAll(".row")[6 - remaining];
        const tiles = row.children;
        let tArr = targetWord.split(""), gArr = [...currentGuess], results = Array(wordLen).fill("absent");

        // √ñnce Ye≈üilleri Bul
        gArr.forEach((c, i) => { if(c === tArr[i]) { results[i] = "correct"; tArr[i] = null; gArr[i] = null; }});
        // Sonra Sarƒ±larƒ± Bul
        gArr.forEach((c, i) => { if(c !== null && tArr.includes(c)) { results[i] = "present"; tArr[tArr.indexOf(c)] = null; }});

        // Animasyonlar
        results.forEach((res, i) => {
            const tile = tiles[i];
            setTimeout(() => { 
                tile.classList.add("flip"); 
                AudioEngine.play('flip'); 
            }, i * 150);
            
            setTimeout(() => {
                tile.classList.add(res); 
                tile.removeAttribute("data-state");
                tile.style.boxShadow = "";
                tile.classList.remove("flip");
                
                const keyBtn = Array.from(document.querySelectorAll(".key")).find(k => k.textContent === currentGuess[i] || (currentGuess[i]==="ƒ∞" && k.textContent==="ƒ∞"));
                if(keyBtn) {
                    if(res === "correct") keyBtn.className = "key correct";
                    else if(res === "present" && !keyBtn.classList.contains("correct")) keyBtn.className = "key present";
                    else if(res === "absent" && !keyBtn.classList.contains("correct") && !keyBtn.classList.contains("present")) keyBtn.className = "key absent";
                }
            }, (i * 150) + 300);
        });

        // Sonraki a≈üama (Kazanma veya Devam)
        setTimeout(() => {
            if(guessStr === targetWord) gameWin();
            else {
                remaining--; 
                
                // --- OTOMATƒ∞K DOLDURMA (Ye≈üil harfleri koruma) ---
                let nextGuess = Array(wordLen).fill("");
                let hasAutofill = false;

                for(let i = 0; i < wordLen; i++) {
                    if(results[i] === "correct") {
                        nextGuess[i] = currentGuess[i];
                        hasAutofill = true;
                    }
                }
                
                currentGuess = nextGuess; // Yeni tahmini ayarla

                if(remaining === 0) {
                    gameLose();
                } else {
                    // Eƒüer ye≈üil harf varsa, yeni satƒ±ra yazdƒ±r ve g√∂rsel efekt ver
                    if(hasAutofill) {
                        for(let i=0; i<wordLen; i++) {
                            if(currentGuess[i] !== "") {
                                updateActiveRowForAutofill(i, currentGuess[i]);
                            }
                        }
                        // Hafif bir ses efekti
                        setTimeout(() => AudioEngine.play('pop'), 100);
                    }
                }
            }
        }, wordLen * 150 + 600);
    }

    // --- YENƒ∞ √ñZELLƒ∞K: ƒ∞PUCU (üí°) ---
    function useHint() {
        if(!gameActive) return;
        if(gameState.gold < HINT_COST) { showToast("Enerji Yetersiz!"); AudioEngine.play('error'); return; }
        
        let emptyIndices = [];
        for(let i=0; i<wordLen; i++) if(currentGuess[i] !== targetWord[i]) emptyIndices.push(i);

        if(emptyIndices.length > 0) {
            gameState.gold -= HINT_COST; saveGame(); updateUI(); AudioEngine.play('click');
            
            // ƒ∞pucu Mantƒ±ƒüƒ±: ƒ∞lk harf yoksa ilk harfi, varsa rastgele
            let idx;
            if (emptyIndices.includes(0)) {
                idx = 0;
            } else {
                idx = emptyIndices[Math.floor(Math.random() * emptyIndices.length)];
            }

            currentGuess[idx] = targetWord[idx];
            updateActiveRow(idx, targetWord[idx]);
            const tile = document.querySelectorAll(".row")[6 - remaining].children[idx];
            tile.style.boxShadow = "0 0 20px #0aff68"; 
            tile.style.borderColor = "#0aff68";
        }
    }

    // --- YENƒ∞ √ñZELLƒ∞K: BOMBA / HARF ELETME (üí£) ---
    function eliminateKeys() {
        if(!gameActive) return;
        if(gameState.gold < BOMB_COST) { showToast("Enerji Yetersiz!"); AudioEngine.play('error'); return; }

        // Klavyedeki t√ºm harfleri bul (Q, W, X zaten yok ama kontrol yine de T√ºrk√ße harflere g√∂re)
        const allKeys = Array.from(document.querySelectorAll(".key")).filter(k => k.textContent.length === 1 && "ABC√áDEFGƒûHIƒ∞JKLMNO√ñPRS≈ûTU√úVYZ".includes(k.textContent));
        
        // Elenebilecek harfler: Kelimede YOK ve hen√ºz i≈üaretlenmemi≈ü (gri/sarƒ±/ye≈üil deƒüil)
        const candidates = allKeys.filter(k => {
            const letter = k.textContent;
            return !targetWord.includes(letter) && 
                   !k.classList.contains("absent") && 
                   !k.classList.contains("present") && 
                   !k.classList.contains("correct");
        });

        if(candidates.length === 0) { showToast("Elenecek harf yok!"); return; }

        // Rastgele 3 tanesini se√ß (veya daha az varsa hepsini)
        gameState.gold -= BOMB_COST; saveGame(); updateUI(); AudioEngine.play('bomb');
        
        let count = Math.min(3, candidates.length);
        for(let i=0; i<count; i++) {
            const randomIdx = Math.floor(Math.random() * candidates.length);
            const keyToEliminate = candidates[randomIdx];
            keyToEliminate.classList.add("absent");
            candidates.splice(randomIdx, 1);
        }
        showToast("3 Harf Elendi!");
    }

    // --- YENƒ∞ √ñZELLƒ∞K: PES ETME (üè≥Ô∏è) ---
    function surrender() {
        if(!gameActive) return;
        if(confirm("Pes etmek istediƒüine emin misin? Kelime a√ßƒ±klanacak ve oyunu kaybedeceksin.")) {
            gameLose();
        }
    }

    function gameWin() {
        gameActive = false; AudioEngine.play('win'); confettiEffect();
        
        // Zaman Bonusu Hesabƒ±
        const timeTaken = Date.now() - levelStartTime;
        let bonus = 0;
        if(timeTaken < TIME_BONUS_LIMIT) {
            bonus = 25; // Hƒ±zlƒ± bitirme bonusu
        }

        gameState.level++; 
        gameState.gold += (WIN_REWARD + bonus);
        gameState.stats.played++;
        gameState.stats.wins++;
        gameState.stats.streak++;
        if(gameState.stats.streak > gameState.stats.maxStreak) gameState.stats.maxStreak = gameState.stats.streak;
        saveGame(); updateUI();

        document.getElementById("modal-title").textContent = "SEVƒ∞YE TAMAMLANDI";
        document.getElementById("modal-title").style.color = "var(--neon-green)";
        document.getElementById("modal-reward").textContent = `+${WIN_REWARD} Enerji`;
        
        const tbDiv = document.getElementById("time-bonus");
        if(bonus > 0) {
            tbDiv.style.display = "block";
            tbDiv.textContent = `‚ö° Hƒ±z Bonusu: +${bonus}`;
        } else {
            tbDiv.style.display = "none";
        }

        document.getElementById("modal-emoji").textContent = "üöÄ";
        document.getElementById("word-reveal").textContent = targetWord;
        document.querySelector(".btn-primary").textContent = "SONRAKƒ∞ SEVƒ∞YE";
        openModal("result-modal");
    }

    function gameLose() {
        gameActive = false; AudioEngine.play('error');
        
        gameState.stats.played++;
        gameState.stats.streak = 0;
        saveGame(); updateUI();

        document.getElementById("modal-title").textContent = "OYUN Bƒ∞TTƒ∞";
        document.getElementById("modal-title").style.color = "var(--neon-red)";
        document.getElementById("modal-reward").textContent = "";
        document.getElementById("time-bonus").style.display = "none";
        document.getElementById("modal-emoji").textContent = "‚ö†Ô∏è";
        document.getElementById("word-reveal").textContent = targetWord;
        document.querySelector(".btn-primary").textContent = "TEKRAR DENE";
        openModal("result-modal");
    }

    function nextLevel() { setupLevel(); }

    function showToast(msg) {
        const t = document.createElement("div"); 
        t.className = "toast"; 
        if(msg.includes("!")) t.classList.add("info");
        t.textContent = msg;
        document.getElementById("toast-container").appendChild(t);
        setTimeout(() => t.remove(), 2500);
    }

    function openModal(id) { document.getElementById(id).style.display = "flex"; }
    function closeModal(id) { document.getElementById(id).style.display = "none"; }

    function confettiEffect() {
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let particles = [];
        for(let i=0; i<120; i++) particles.push({
            x: window.innerWidth/2, y: window.innerHeight/2,
            vx: (Math.random()-0.5)*35, vy: (Math.random()-1)*35-5,
            c: ['#00f3ff', '#ff00ff', '#0aff68', '#ffee00'][Math.floor(Math.random()*4)],
            size: Math.random()*6+2
        });
        function loop() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.vy += 0.6; p.size *= 0.95;
                ctx.fillStyle = p.c; ctx.shadowBlur=15; ctx.shadowColor=p.c;
                ctx.fillRect(p.x, p.y, p.size, p.size);
                if(p.size<0.5) particles.splice(i, 1);
            });
            if(particles.length) requestAnimationFrame(loop);
        }
        loop();
    }

    document.addEventListener("keydown", (e) => {
        let key = e.key.toLocaleUpperCase('tr-TR');
        if(key === "ENTER") handleInput("Enter");
        else if(key === "BACKSPACE") handleInput("Del");
        else if("ABC√áDEFGƒûHIƒ∞JKLMNO√ñPRS≈ûTU√úVYZ".includes(key) && key.length === 1) handleInput(key);
    });

    init();
</script>
</body>
</html>